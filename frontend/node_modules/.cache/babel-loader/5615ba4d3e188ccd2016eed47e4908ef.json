{"ast":null,"code":"'use strict';\n\nconst cleanPositionalOperators = require('../schema/cleanPositionalOperators');\n\nconst handleTimestampOption = require('../schema/handleTimestampOption');\n\nmodule.exports = applyTimestampsToChildren;\n/*!\n * ignore\n */\n\nfunction applyTimestampsToChildren(now, update, schema) {\n  if (update == null) {\n    return;\n  }\n\n  const keys = Object.keys(update);\n  const hasDollarKey = keys.some(key => key.startsWith('$'));\n\n  if (hasDollarKey) {\n    if (update.$push) {\n      for (const key of Object.keys(update.$push)) {\n        const $path = schema.path(key);\n\n        if (update.$push[key] && $path && $path.$isMongooseDocumentArray && $path.schema.options.timestamps) {\n          const timestamps = $path.schema.options.timestamps;\n          const createdAt = handleTimestampOption(timestamps, 'createdAt');\n          const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n          if (update.$push[key].$each) {\n            update.$push[key].$each.forEach(function (subdoc) {\n              if (updatedAt != null) {\n                subdoc[updatedAt] = now;\n              }\n\n              if (createdAt != null) {\n                subdoc[createdAt] = now;\n              }\n            });\n          } else {\n            if (updatedAt != null) {\n              update.$push[key][updatedAt] = now;\n            }\n\n            if (createdAt != null) {\n              update.$push[key][createdAt] = now;\n            }\n          }\n        }\n      }\n    }\n\n    if (update.$set != null) {\n      const keys = Object.keys(update.$set);\n\n      for (const key of keys) {\n        applyTimestampsToUpdateKey(schema, key, update.$set, now);\n      }\n    }\n  }\n\n  const updateKeys = Object.keys(update).filter(key => !key.startsWith('$'));\n\n  for (const key of updateKeys) {\n    applyTimestampsToUpdateKey(schema, key, update, now);\n  }\n}\n\nfunction applyTimestampsToDocumentArray(arr, schematype, now) {\n  const timestamps = schematype.schema.options.timestamps;\n\n  if (!timestamps) {\n    return;\n  }\n\n  const len = arr.length;\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n  for (let i = 0; i < len; ++i) {\n    if (updatedAt != null) {\n      arr[i][updatedAt] = now;\n    }\n\n    if (createdAt != null) {\n      arr[i][createdAt] = now;\n    }\n\n    applyTimestampsToChildren(now, arr[i], schematype.schema);\n  }\n}\n\nfunction applyTimestampsToSingleNested(subdoc, schematype, now) {\n  const timestamps = schematype.schema.options.timestamps;\n\n  if (!timestamps) {\n    return;\n  }\n\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n  if (updatedAt != null) {\n    subdoc[updatedAt] = now;\n  }\n\n  if (createdAt != null) {\n    subdoc[createdAt] = now;\n  }\n\n  applyTimestampsToChildren(now, subdoc, schematype.schema);\n}\n\nfunction applyTimestampsToUpdateKey(schema, key, update, now) {\n  // Replace positional operator `$` and array filters `$[]` and `$[.*]`\n  const keyToSearch = cleanPositionalOperators(key);\n  const path = schema.path(keyToSearch);\n\n  if (!path) {\n    return;\n  }\n\n  const parentSchemaTypes = [];\n  const pieces = keyToSearch.split('.');\n\n  for (let i = pieces.length - 1; i > 0; --i) {\n    const s = schema.path(pieces.slice(0, i).join('.'));\n\n    if (s != null && (s.$isMongooseDocumentArray || s.$isSingleNested)) {\n      parentSchemaTypes.push({\n        parentPath: key.split('.').slice(0, i).join('.'),\n        parentSchemaType: s\n      });\n    }\n  }\n\n  if (Array.isArray(update[key]) && path.$isMongooseDocumentArray) {\n    applyTimestampsToDocumentArray(update[key], path, now);\n  } else if (update[key] && path.$isSingleNested) {\n    applyTimestampsToSingleNested(update[key], path, now);\n  } else if (parentSchemaTypes.length > 0) {\n    for (const item of parentSchemaTypes) {\n      const parentPath = item.parentPath;\n      const parentSchemaType = item.parentSchemaType;\n      const timestamps = parentSchemaType.schema.options.timestamps;\n      const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n      if (!timestamps || updatedAt == null) {\n        continue;\n      }\n\n      if (parentSchemaType.$isSingleNested) {\n        // Single nested is easy\n        update[parentPath + '.' + updatedAt] = now;\n      } else if (parentSchemaType.$isMongooseDocumentArray) {\n        let childPath = key.substr(parentPath.length + 1);\n\n        if (/^\\d+$/.test(childPath)) {\n          update[parentPath + '.' + childPath][updatedAt] = now;\n          continue;\n        }\n\n        const firstDot = childPath.indexOf('.');\n        childPath = firstDot !== -1 ? childPath.substr(0, firstDot) : childPath;\n        update[parentPath + '.' + childPath + '.' + updatedAt] = now;\n      }\n    }\n  } else if (path.schema != null && path.schema != schema && update[key]) {\n    const timestamps = path.schema.options.timestamps;\n    const createdAt = handleTimestampOption(timestamps, 'createdAt');\n    const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n    if (!timestamps) {\n      return;\n    }\n\n    if (updatedAt != null) {\n      update[key][updatedAt] = now;\n    }\n\n    if (createdAt != null) {\n      update[key][createdAt] = now;\n    }\n  }\n}","map":{"version":3,"sources":["C:/Users/Thakshan/Desktop/BookCorner/node_modules/mongoose/lib/helpers/update/applyTimestampsToChildren.js"],"names":["cleanPositionalOperators","require","handleTimestampOption","module","exports","applyTimestampsToChildren","now","update","schema","keys","Object","hasDollarKey","some","key","startsWith","$push","$path","path","$isMongooseDocumentArray","options","timestamps","createdAt","updatedAt","$each","forEach","subdoc","$set","applyTimestampsToUpdateKey","updateKeys","filter","applyTimestampsToDocumentArray","arr","schematype","len","length","i","applyTimestampsToSingleNested","keyToSearch","parentSchemaTypes","pieces","split","s","slice","join","$isSingleNested","push","parentPath","parentSchemaType","Array","isArray","item","childPath","substr","test","firstDot","indexOf"],"mappings":"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","sourcesContent":["'use strict';\n\nconst cleanPositionalOperators = require('../schema/cleanPositionalOperators');\nconst handleTimestampOption = require('../schema/handleTimestampOption');\n\nmodule.exports = applyTimestampsToChildren;\n\n/*!\n * ignore\n */\n\nfunction applyTimestampsToChildren(now, update, schema) {\n  if (update == null) {\n    return;\n  }\n\n  const keys = Object.keys(update);\n  const hasDollarKey = keys.some(key => key.startsWith('$'));\n\n  if (hasDollarKey) {\n    if (update.$push) {\n      for (const key of Object.keys(update.$push)) {\n        const $path = schema.path(key);\n        if (update.$push[key] &&\n            $path &&\n            $path.$isMongooseDocumentArray &&\n            $path.schema.options.timestamps) {\n          const timestamps = $path.schema.options.timestamps;\n          const createdAt = handleTimestampOption(timestamps, 'createdAt');\n          const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n          if (update.$push[key].$each) {\n            update.$push[key].$each.forEach(function(subdoc) {\n              if (updatedAt != null) {\n                subdoc[updatedAt] = now;\n              }\n              if (createdAt != null) {\n                subdoc[createdAt] = now;\n              }\n            });\n          } else {\n            if (updatedAt != null) {\n              update.$push[key][updatedAt] = now;\n            }\n            if (createdAt != null) {\n              update.$push[key][createdAt] = now;\n            }\n          }\n        }\n      }\n    }\n    if (update.$set != null) {\n      const keys = Object.keys(update.$set);\n      for (const key of keys) {\n        applyTimestampsToUpdateKey(schema, key, update.$set, now);\n      }\n    }\n  }\n\n  const updateKeys = Object.keys(update).filter(key => !key.startsWith('$'));\n  for (const key of updateKeys) {\n    applyTimestampsToUpdateKey(schema, key, update, now);\n  }\n}\n\nfunction applyTimestampsToDocumentArray(arr, schematype, now) {\n  const timestamps = schematype.schema.options.timestamps;\n\n  if (!timestamps) {\n    return;\n  }\n\n  const len = arr.length;\n\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n  for (let i = 0; i < len; ++i) {\n    if (updatedAt != null) {\n      arr[i][updatedAt] = now;\n    }\n    if (createdAt != null) {\n      arr[i][createdAt] = now;\n    }\n\n    applyTimestampsToChildren(now, arr[i], schematype.schema);\n  }\n}\n\nfunction applyTimestampsToSingleNested(subdoc, schematype, now) {\n  const timestamps = schematype.schema.options.timestamps;\n  if (!timestamps) {\n    return;\n  }\n\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n  if (updatedAt != null) {\n    subdoc[updatedAt] = now;\n  }\n  if (createdAt != null) {\n    subdoc[createdAt] = now;\n  }\n\n  applyTimestampsToChildren(now, subdoc, schematype.schema);\n}\n\nfunction applyTimestampsToUpdateKey(schema, key, update, now) {\n  // Replace positional operator `$` and array filters `$[]` and `$[.*]`\n  const keyToSearch = cleanPositionalOperators(key);\n  const path = schema.path(keyToSearch);\n  if (!path) {\n    return;\n  }\n\n  const parentSchemaTypes = [];\n  const pieces = keyToSearch.split('.');\n  for (let i = pieces.length - 1; i > 0; --i) {\n    const s = schema.path(pieces.slice(0, i).join('.'));\n    if (s != null &&\n      (s.$isMongooseDocumentArray || s.$isSingleNested)) {\n      parentSchemaTypes.push({ parentPath: key.split('.').slice(0, i).join('.'), parentSchemaType: s });\n    }\n  }\n\n  if (Array.isArray(update[key]) && path.$isMongooseDocumentArray) {\n    applyTimestampsToDocumentArray(update[key], path, now);\n  } else if (update[key] && path.$isSingleNested) {\n    applyTimestampsToSingleNested(update[key], path, now);\n  } else if (parentSchemaTypes.length > 0) {\n    for (const item of parentSchemaTypes) {\n      const parentPath = item.parentPath;\n      const parentSchemaType = item.parentSchemaType;\n      const timestamps = parentSchemaType.schema.options.timestamps;\n      const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n      if (!timestamps || updatedAt == null) {\n        continue;\n      }\n\n      if (parentSchemaType.$isSingleNested) {\n        // Single nested is easy\n        update[parentPath + '.' + updatedAt] = now;\n      } else if (parentSchemaType.$isMongooseDocumentArray) {\n        let childPath = key.substr(parentPath.length + 1);\n\n        if (/^\\d+$/.test(childPath)) {\n          update[parentPath + '.' + childPath][updatedAt] = now;\n          continue;\n        }\n\n        const firstDot = childPath.indexOf('.');\n        childPath = firstDot !== -1 ? childPath.substr(0, firstDot) : childPath;\n\n        update[parentPath + '.' + childPath + '.' + updatedAt] = now;\n      }\n    }\n  } else if (path.schema != null && path.schema != schema && update[key]) {\n    const timestamps = path.schema.options.timestamps;\n    const createdAt = handleTimestampOption(timestamps, 'createdAt');\n    const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n\n    if (!timestamps) {\n      return;\n    }\n\n    if (updatedAt != null) {\n      update[key][updatedAt] = now;\n    }\n    if (createdAt != null) {\n      update[key][createdAt] = now;\n    }\n  }\n}"]},"metadata":{},"sourceType":"script"}