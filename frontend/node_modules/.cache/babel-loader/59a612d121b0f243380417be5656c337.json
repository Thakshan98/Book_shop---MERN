{"ast":null,"code":"'use strict';\n/*!\n * Module dependencies.\n */\n\nconst ms = require('ms');\n\nconst mpath = require('mpath');\n\nconst sliced = require('sliced');\n\nconst Buffer = require('safe-buffer').Buffer;\n\nconst Decimal = require('./types/decimal128');\n\nconst ObjectId = require('./types/objectid');\n\nconst PopulateOptions = require('./options/PopulateOptions');\n\nconst clone = require('./helpers/clone');\n\nconst isObject = require('./helpers/isObject');\n\nconst isBsonType = require('./helpers/isBsonType');\n\nconst getFunctionName = require('./helpers/getFunctionName');\n\nconst isMongooseObject = require('./helpers/isMongooseObject');\n\nconst promiseOrCallback = require('./helpers/promiseOrCallback');\n\nconst specialProperties = require('./helpers/specialProperties');\n\nlet Document;\nexports.specialProperties = specialProperties;\n/*!\n * Produces a collection name from model `name`. By default, just returns\n * the model name\n *\n * @param {String} name a model name\n * @param {Function} pluralize function that pluralizes the collection name\n * @return {String} a collection name\n * @api private\n */\n\nexports.toCollectionName = function (name, pluralize) {\n  if (name === 'system.profile') {\n    return name;\n  }\n\n  if (name === 'system.indexes') {\n    return name;\n  }\n\n  if (typeof pluralize === 'function') {\n    return pluralize(name);\n  }\n\n  return name;\n};\n/*!\n * Determines if `a` and `b` are deep equal.\n *\n * Modified from node/lib/assert.js\n *\n * @param {any} a a value to compare to `b`\n * @param {any} b a value to compare to `a`\n * @return {Boolean}\n * @api private\n */\n\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n\n  if (isBsonType(a, 'ObjectID') && isBsonType(b, 'ObjectID') || isBsonType(a, 'Decimal128') && isBsonType(b, 'Decimal128')) {\n    return a.toString() === b.toString();\n  }\n\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.global === b.global;\n  }\n\n  if (typeof a !== 'object' && typeof b !== 'object') {\n    return a === b;\n  }\n\n  if (a === null || b === null || a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (a.prototype !== b.prototype) {\n    return false;\n  } // Handle MongooseNumbers\n\n\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n\n  if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n\n  if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n\n  let ka;\n  let kb;\n  let key;\n  let i;\n\n  try {\n    ka = Object.keys(a);\n    kb = Object.keys(b);\n  } catch (e) {\n    // happens when one is a string literal and the other isn't\n    return false;\n  } // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n\n\n  if (ka.length !== kb.length) {\n    return false;\n  } // the same set of keys (although not necessarily the same order),\n\n\n  ka.sort();\n  kb.sort(); // ~~~cheap key test\n\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  } // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n\n\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n/*!\n * Get the last element of an array\n */\n\n\nexports.last = function (arr) {\n  if (arr.length > 0) {\n    return arr[arr.length - 1];\n  }\n\n  return void 0;\n};\n\nexports.clone = clone;\n/*!\n * ignore\n */\n\nexports.promiseOrCallback = promiseOrCallback;\n/*!\n * ignore\n */\n\nexports.omit = function omit(obj, keys) {\n  if (keys == null) {\n    return Object.assign({}, obj);\n  }\n\n  if (!Array.isArray(keys)) {\n    keys = [keys];\n  }\n\n  const ret = Object.assign({}, obj);\n\n  for (const key of keys) {\n    delete ret[key];\n  }\n\n  return ret;\n};\n/*!\n * Shallow copies defaults into options.\n *\n * @param {Object} defaults\n * @param {Object} options\n * @return {Object} the merged object\n * @api private\n */\n\n\nexports.options = function (defaults, options) {\n  const keys = Object.keys(defaults);\n  let i = keys.length;\n  let k;\n  options = options || {};\n\n  while (i--) {\n    k = keys[i];\n\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n\n  return options;\n};\n/*!\n * Generates a random string\n *\n * @api private\n */\n\n\nexports.random = function () {\n  return Math.random().toString().substr(3);\n};\n/*!\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\n\nexports.merge = function merge(to, from, options, path) {\n  options = options || {};\n  const keys = Object.keys(from);\n  let i = 0;\n  const len = keys.length;\n  let key;\n  path = path || '';\n  const omitNested = options.omitNested || {};\n\n  while (i < len) {\n    key = keys[i++];\n\n    if (options.omit && options.omit[key]) {\n      continue;\n    }\n\n    if (omitNested[path]) {\n      continue;\n    }\n\n    if (specialProperties.has(key)) {\n      continue;\n    }\n\n    if (to[key] == null) {\n      to[key] = from[key];\n    } else if (exports.isObject(from[key])) {\n      if (!exports.isObject(to[key])) {\n        to[key] = {};\n      }\n\n      if (from[key] != null) {\n        if (from[key].instanceOfSchema) {\n          if (to[key].instanceOfSchema) {\n            to[key].add(from[key].clone());\n          } else {\n            to[key] = from[key].clone();\n          }\n\n          continue;\n        } else if (from[key] instanceof ObjectId) {\n          to[key] = new ObjectId(from[key]);\n          continue;\n        }\n      }\n\n      merge(to[key], from[key], options, path ? path + '.' + key : key);\n    } else if (options.overwrite) {\n      to[key] = from[key];\n    }\n  }\n};\n/*!\n * Applies toObject recursively.\n *\n * @param {Document|Array|Object} obj\n * @return {Object}\n * @api private\n */\n\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  let ret;\n\n  if (obj == null) {\n    return obj;\n  }\n\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n\n  if (Array.isArray(obj)) {\n    ret = [];\n\n    for (const doc of obj) {\n      ret.push(toObject(doc));\n    }\n\n    return ret;\n  }\n\n  if (exports.isPOJO(obj)) {\n    ret = {};\n\n    for (const k in obj) {\n      if (specialProperties.has(k)) {\n        continue;\n      }\n\n      ret[k] = toObject(obj[k]);\n    }\n\n    return ret;\n  }\n\n  return obj;\n};\n\nexports.isObject = isObject;\n/*!\n * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,\n * `arg` must be an object but not an instance of any special class, like String,\n * ObjectId, etc.\n *\n * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\nexports.isPOJO = function isPOJO(arg) {\n  if (arg == null || typeof arg !== 'object') {\n    return false;\n  }\n\n  const proto = Object.getPrototypeOf(arg); // Prototype may be null if you used `Object.create(null)`\n  // Checking `proto`'s constructor is safe because `getPrototypeOf()`\n  // explicitly crosses the boundary from object data to object metadata\n\n  return !proto || proto.constructor.name === 'Object';\n};\n/*!\n * Determines if `obj` is a built-in object like an array, date, boolean,\n * etc.\n */\n\n\nexports.isNativeObject = function (arg) {\n  return Array.isArray(arg) || arg instanceof Date || arg instanceof Boolean || arg instanceof Number || arg instanceof String;\n};\n/*!\n * Determines if `val` is an object that has no own keys\n */\n\n\nexports.isEmptyObject = function (val) {\n  return val != null && typeof val === 'object' && Object.keys(val).length === 0;\n};\n/*!\n * Search if `obj` or any POJOs nested underneath `obj` has a property named\n * `key`\n */\n\n\nexports.hasKey = function hasKey(obj, key) {\n  const props = Object.keys(obj);\n\n  for (const prop of props) {\n    if (prop === key) {\n      return true;\n    }\n\n    if (exports.isPOJO(obj[prop]) && exports.hasKey(obj[prop], key)) {\n      return true;\n    }\n  }\n\n  return false;\n};\n/*!\n * A faster Array.prototype.slice.call(arguments) alternative\n * @api private\n */\n\n\nexports.args = sliced;\n/*!\n * process.nextTick helper.\n *\n * Wraps `callback` in a try/catch + nextTick.\n *\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\n *\n * @param {Function} callback\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n\n  return function () {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      process.nextTick(function () {\n        throw err;\n      });\n    }\n  };\n};\n/*!\n * Returns true if `v` is an object that can be serialized as a primitive in\n * MongoDB\n */\n\n\nexports.isMongooseType = function (v) {\n  return v instanceof ObjectId || v instanceof Decimal || v instanceof Buffer;\n};\n\nexports.isMongooseObject = isMongooseObject;\n/*!\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\n *\n * @param {Object} object\n * @api private\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n\n  if (!('expires' in object)) {\n    return;\n  }\n\n  let when;\n\n  if (typeof object.expires !== 'string') {\n    when = object.expires;\n  } else {\n    when = Math.round(ms(object.expires) / 1000);\n  }\n\n  object.expireAfterSeconds = when;\n  delete object.expires;\n};\n/*!\n * populate helper\n */\n\n\nexports.populate = function populate(path, select, model, match, options, subPopulate, justOne, count) {\n  // might have passed an object specifying all arguments\n  let obj = null;\n\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      return [path];\n    }\n\n    if (Array.isArray(path)) {\n      const singles = makeSingles(path);\n      return singles.map(o => exports.populate(o)[0]);\n    }\n\n    if (exports.isObject(path)) {\n      obj = Object.assign({}, path);\n    } else {\n      obj = {\n        path: path\n      };\n    }\n  } else if (typeof model === 'object') {\n    obj = {\n      path: path,\n      select: select,\n      match: model,\n      options: match\n    };\n  } else {\n    obj = {\n      path: path,\n      select: select,\n      model: model,\n      match: match,\n      options: options,\n      populate: subPopulate,\n      justOne: justOne,\n      count: count\n    };\n  }\n\n  if (typeof obj.path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n\n  return _populateObj(obj); // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n\n  function makeSingles(arr) {\n    const ret = [];\n    arr.forEach(function (obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const paths = obj.path.split(' ');\n        paths.forEach(function (p) {\n          const copy = Object.assign({}, obj);\n          copy.path = p;\n          ret.push(copy);\n        });\n      } else {\n        ret.push(obj);\n      }\n    });\n    return ret;\n  }\n};\n\nfunction _populateObj(obj) {\n  if (Array.isArray(obj.populate)) {\n    const ret = [];\n    obj.populate.forEach(function (obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const copy = Object.assign({}, obj);\n        const paths = copy.path.split(' ');\n        paths.forEach(function (p) {\n          copy.path = p;\n          ret.push(exports.populate(copy)[0]);\n        });\n      } else {\n        ret.push(exports.populate(obj)[0]);\n      }\n    });\n    obj.populate = exports.populate(ret);\n  } else if (obj.populate != null && typeof obj.populate === 'object') {\n    obj.populate = exports.populate(obj.populate);\n  }\n\n  const ret = [];\n  const paths = obj.path.split(' ');\n\n  if (obj.options != null) {\n    obj.options = exports.clone(obj.options);\n  }\n\n  for (const path of paths) {\n    ret.push(new PopulateOptions(Object.assign({}, obj, {\n      path: path\n    })));\n  }\n\n  return ret;\n}\n/*!\n * Return the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Object} obj\n */\n\n\nexports.getValue = function (path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n/*!\n * Sets the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Anything} val\n * @param {Object} obj\n */\n\n\nexports.setValue = function (path, val, obj, map, _copying) {\n  mpath.set(path, val, obj, '_doc', map, _copying);\n};\n/*!\n * Returns an array of values from object `o`.\n *\n * @param {Object} o\n * @return {Array}\n * @private\n */\n\n\nexports.object = {};\n\nexports.object.vals = function vals(o) {\n  const keys = Object.keys(o);\n  let i = keys.length;\n  const ret = [];\n\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n\n  return ret;\n};\n/*!\n * @see exports.options\n */\n\n\nexports.object.shallowCopy = exports.options;\n/*!\n * Safer helper for hasOwnProperty checks\n *\n * @param {Object} obj\n * @param {String} prop\n */\n\nconst hop = Object.prototype.hasOwnProperty;\n\nexports.object.hasOwnProperty = function (obj, prop) {\n  return hop.call(obj, prop);\n};\n/*!\n * Determine if `val` is null or undefined\n *\n * @return {Boolean}\n */\n\n\nexports.isNullOrUndefined = function (val) {\n  return val === null || val === undefined;\n};\n/*!\n * ignore\n */\n\n\nexports.array = {};\n/*!\n * Flattens an array.\n *\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\n *\n * @param {Array} arr\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.\n * @return {Array}\n * @private\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n  arr.forEach(function (item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n  return ret;\n};\n/*!\n * ignore\n */\n\n\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexports.hasUserDefinedProperty = function (obj, key) {\n  if (obj == null) {\n    return false;\n  }\n\n  if (Array.isArray(key)) {\n    for (const k of key) {\n      if (exports.hasUserDefinedProperty(obj, k)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  if (_hasOwnProperty.call(obj, key)) {\n    return true;\n  }\n\n  if (typeof obj === 'object' && key in obj) {\n    const v = obj[key];\n    return v !== Object.prototype[key] && v !== Array.prototype[key];\n  }\n\n  return false;\n};\n/*!\n * ignore\n */\n\n\nconst MAX_ARRAY_INDEX = Math.pow(2, 32) - 1;\n\nexports.isArrayIndex = function (val) {\n  if (typeof val === 'number') {\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n\n  if (typeof val === 'string') {\n    if (!/^\\d+$/.test(val)) {\n      return false;\n    }\n\n    val = +val;\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n\n  return false;\n};\n/*!\n * Removes duplicate values from an array\n *\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\n *\n * @param {Array} arr\n * @return {Array}\n * @private\n */\n\n\nexports.array.unique = function (arr) {\n  const primitives = {};\n  const ids = {};\n  const ret = [];\n\n  for (const item of arr) {\n    if (typeof item === 'number' || typeof item === 'string' || item == null) {\n      if (primitives[item]) {\n        continue;\n      }\n\n      ret.push(item);\n      primitives[item] = true;\n    } else if (item instanceof ObjectId) {\n      if (ids[item.toString()]) {\n        continue;\n      }\n\n      ret.push(item);\n      ids[item.toString()] = true;\n    } else {\n      ret.push(item);\n    }\n  }\n\n  return ret;\n};\n/*!\n * Determines if two buffers are equal.\n *\n * @param {Buffer} a\n * @param {Object} b\n */\n\n\nexports.buffer = {};\n\nexports.buffer.areEqual = function (a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexports.getFunctionName = getFunctionName;\n/*!\n * Decorate buffers\n */\n\nexports.decorate = function (destination, source) {\n  for (const key in source) {\n    if (specialProperties.has(key)) {\n      continue;\n    }\n\n    destination[key] = source[key];\n  }\n};\n/**\n * merges to with a copy of from\n *\n * @param {Object} to\n * @param {Object} fromObj\n * @api private\n */\n\n\nexports.mergeClone = function (to, fromObj) {\n  if (isMongooseObject(fromObj)) {\n    fromObj = fromObj.toObject({\n      transform: false,\n      virtuals: false,\n      depopulate: true,\n      getters: false,\n      flattenDecimals: false\n    });\n  }\n\n  const keys = Object.keys(fromObj);\n  const len = keys.length;\n  let i = 0;\n  let key;\n\n  while (i < len) {\n    key = keys[i++];\n\n    if (specialProperties.has(key)) {\n      continue;\n    }\n\n    if (typeof to[key] === 'undefined') {\n      to[key] = exports.clone(fromObj[key], {\n        transform: false,\n        virtuals: false,\n        depopulate: true,\n        getters: false,\n        flattenDecimals: false\n      });\n    } else {\n      let val = fromObj[key];\n\n      if (val != null && val.valueOf && !(val instanceof Date)) {\n        val = val.valueOf();\n      }\n\n      if (exports.isObject(val)) {\n        let obj = val;\n\n        if (isMongooseObject(val) && !val.isMongooseBuffer) {\n          obj = obj.toObject({\n            transform: false,\n            virtuals: false,\n            depopulate: true,\n            getters: false,\n            flattenDecimals: false\n          });\n        }\n\n        if (val.isMongooseBuffer) {\n          obj = Buffer.from(obj);\n        }\n\n        exports.mergeClone(to[key], obj);\n      } else {\n        to[key] = exports.clone(val, {\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n/**\n * Executes a function on each element of an array (like _.each)\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\n\nexports.each = function (arr, fn) {\n  for (const item of arr) {\n    fn(item);\n  }\n};\n/*!\n * ignore\n */\n\n\nexports.getOption = function (name) {\n  const sources = Array.prototype.slice.call(arguments, 1);\n\n  for (const source of sources) {\n    if (source[name] != null) {\n      return source[name];\n    }\n  }\n\n  return null;\n};\n/*!\n * ignore\n */\n\n\nexports.noop = function () {};","map":{"version":3,"sources":["C:/Users/Thakshan/Desktop/BookCorner/node_modules/mongoose/lib/utils.js"],"names":["ms","require","mpath","sliced","Buffer","Decimal","ObjectId","PopulateOptions","clone","isObject","isBsonType","getFunctionName","isMongooseObject","promiseOrCallback","specialProperties","Document","exports","toCollectionName","name","pluralize","deepEqual","a","b","Date","getTime","toString","RegExp","source","ignoreCase","multiline","global","undefined","prototype","Number","valueOf","isBuffer","buffer","areEqual","toObject","ka","kb","key","i","Object","keys","e","length","sort","last","arr","omit","obj","assign","Array","isArray","ret","options","defaults","k","random","Math","substr","merge","to","from","path","len","omitNested","has","instanceOfSchema","add","overwrite","doc","push","isPOJO","arg","proto","getPrototypeOf","constructor","isNativeObject","Boolean","String","isEmptyObject","val","hasKey","props","prop","args","tick","callback","apply","arguments","err","process","nextTick","isMongooseType","v","expires","object","when","round","expireAfterSeconds","populate","select","model","match","subPopulate","justOne","count","singles","makeSingles","map","o","TypeError","_populateObj","forEach","test","paths","split","p","copy","getValue","get","setValue","_copying","set","vals","shallowCopy","hop","hasOwnProperty","call","isNullOrUndefined","array","flatten","filter","item","_hasOwnProperty","hasUserDefinedProperty","MAX_ARRAY_INDEX","pow","isArrayIndex","unique","primitives","ids","decorate","destination","mergeClone","fromObj","transform","virtuals","depopulate","getters","flattenDecimals","isMongooseBuffer","each","fn","getOption","sources","slice","noop"],"mappings":"AAAA;AAEA;;;;AAIA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAC,OAAD,CAArB;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAMG,MAAM,GAAGH,OAAO,CAAC,aAAD,CAAP,CAAuBG,MAAtC;;AACA,MAAMC,OAAO,GAAGJ,OAAO,CAAC,oBAAD,CAAvB;;AACA,MAAMK,QAAQ,GAAGL,OAAO,CAAC,kBAAD,CAAxB;;AACA,MAAMM,eAAe,GAAGN,OAAO,CAAC,2BAAD,CAA/B;;AACA,MAAMO,KAAK,GAAGP,OAAO,CAAC,iBAAD,CAArB;;AACA,MAAMQ,QAAQ,GAAGR,OAAO,CAAC,oBAAD,CAAxB;;AACA,MAAMS,UAAU,GAAGT,OAAO,CAAC,sBAAD,CAA1B;;AACA,MAAMU,eAAe,GAAGV,OAAO,CAAC,2BAAD,CAA/B;;AACA,MAAMW,gBAAgB,GAAGX,OAAO,CAAC,4BAAD,CAAhC;;AACA,MAAMY,iBAAiB,GAAGZ,OAAO,CAAC,6BAAD,CAAjC;;AACA,MAAMa,iBAAiB,GAAGb,OAAO,CAAC,6BAAD,CAAjC;;AAEA,IAAIc,QAAJ;AAEAC,OAAO,CAACF,iBAAR,GAA4BA,iBAA5B;AAEA;;;;;;;;;;AAUAE,OAAO,CAACC,gBAAR,GAA2B,UAASC,IAAT,EAAeC,SAAf,EAA0B;AACnD,MAAID,IAAI,KAAK,gBAAb,EAA+B;AAC7B,WAAOA,IAAP;AACD;;AACD,MAAIA,IAAI,KAAK,gBAAb,EAA+B;AAC7B,WAAOA,IAAP;AACD;;AACD,MAAI,OAAOC,SAAP,KAAqB,UAAzB,EAAqC;AACnC,WAAOA,SAAS,CAACD,IAAD,CAAhB;AACD;;AACD,SAAOA,IAAP;AACD,CAXD;AAaA;;;;;;;;;;;;AAWAF,OAAO,CAACI,SAAR,GAAoB,SAASA,SAAT,CAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;AAC3C,MAAID,CAAC,KAAKC,CAAV,EAAa;AACX,WAAO,IAAP;AACD;;AAED,MAAID,CAAC,YAAYE,IAAb,IAAqBD,CAAC,YAAYC,IAAtC,EAA4C;AAC1C,WAAOF,CAAC,CAACG,OAAF,OAAgBF,CAAC,CAACE,OAAF,EAAvB;AACD;;AAED,MAAKd,UAAU,CAACW,CAAD,EAAI,UAAJ,CAAV,IAA6BX,UAAU,CAACY,CAAD,EAAI,UAAJ,CAAxC,IACCZ,UAAU,CAACW,CAAD,EAAI,YAAJ,CAAV,IAA+BX,UAAU,CAACY,CAAD,EAAI,YAAJ,CAD9C,EACkE;AAChE,WAAOD,CAAC,CAACI,QAAF,OAAiBH,CAAC,CAACG,QAAF,EAAxB;AACD;;AAED,MAAIJ,CAAC,YAAYK,MAAb,IAAuBJ,CAAC,YAAYI,MAAxC,EAAgD;AAC9C,WAAOL,CAAC,CAACM,MAAF,KAAaL,CAAC,CAACK,MAAf,IACHN,CAAC,CAACO,UAAF,KAAiBN,CAAC,CAACM,UADhB,IAEHP,CAAC,CAACQ,SAAF,KAAgBP,CAAC,CAACO,SAFf,IAGHR,CAAC,CAACS,MAAF,KAAaR,CAAC,CAACQ,MAHnB;AAID;;AAED,MAAI,OAAOT,CAAP,KAAa,QAAb,IAAyB,OAAOC,CAAP,KAAa,QAA1C,EAAoD;AAClD,WAAOD,CAAC,KAAKC,CAAb;AACD;;AAED,MAAID,CAAC,KAAK,IAAN,IAAcC,CAAC,KAAK,IAApB,IAA4BD,CAAC,KAAKU,SAAlC,IAA+CT,CAAC,KAAKS,SAAzD,EAAoE;AAClE,WAAO,KAAP;AACD;;AAED,MAAIV,CAAC,CAACW,SAAF,KAAgBV,CAAC,CAACU,SAAtB,EAAiC;AAC/B,WAAO,KAAP;AACD,GA/B0C,CAiC3C;;;AACA,MAAIX,CAAC,YAAYY,MAAb,IAAuBX,CAAC,YAAYW,MAAxC,EAAgD;AAC9C,WAAOZ,CAAC,CAACa,OAAF,OAAgBZ,CAAC,CAACY,OAAF,EAAvB;AACD;;AAED,MAAI9B,MAAM,CAAC+B,QAAP,CAAgBd,CAAhB,CAAJ,EAAwB;AACtB,WAAOL,OAAO,CAACoB,MAAR,CAAeC,QAAf,CAAwBhB,CAAxB,EAA2BC,CAA3B,CAAP;AACD;;AAED,MAAIV,gBAAgB,CAACS,CAAD,CAApB,EAAyB;AACvBA,IAAAA,CAAC,GAAGA,CAAC,CAACiB,QAAF,EAAJ;AACD;;AACD,MAAI1B,gBAAgB,CAACU,CAAD,CAApB,EAAyB;AACvBA,IAAAA,CAAC,GAAGA,CAAC,CAACgB,QAAF,EAAJ;AACD;;AAED,MAAIC,EAAJ;AACA,MAAIC,EAAJ;AACA,MAAIC,GAAJ;AACA,MAAIC,CAAJ;;AACA,MAAI;AACFH,IAAAA,EAAE,GAAGI,MAAM,CAACC,IAAP,CAAYvB,CAAZ,CAAL;AACAmB,IAAAA,EAAE,GAAGG,MAAM,CAACC,IAAP,CAAYtB,CAAZ,CAAL;AACD,GAHD,CAGE,OAAOuB,CAAP,EAAU;AACV;AACA,WAAO,KAAP;AACD,GA3D0C,CA6D3C;AACA;;;AACA,MAAIN,EAAE,CAACO,MAAH,KAAcN,EAAE,CAACM,MAArB,EAA6B;AAC3B,WAAO,KAAP;AACD,GAjE0C,CAmE3C;;;AACAP,EAAAA,EAAE,CAACQ,IAAH;AACAP,EAAAA,EAAE,CAACO,IAAH,GArE2C,CAuE3C;;AACA,OAAKL,CAAC,GAAGH,EAAE,CAACO,MAAH,GAAY,CAArB,EAAwBJ,CAAC,IAAI,CAA7B,EAAgCA,CAAC,EAAjC,EAAqC;AACnC,QAAIH,EAAE,CAACG,CAAD,CAAF,KAAUF,EAAE,CAACE,CAAD,CAAhB,EAAqB;AACnB,aAAO,KAAP;AACD;AACF,GA5E0C,CA8E3C;AACA;;;AACA,OAAKA,CAAC,GAAGH,EAAE,CAACO,MAAH,GAAY,CAArB,EAAwBJ,CAAC,IAAI,CAA7B,EAAgCA,CAAC,EAAjC,EAAqC;AACnCD,IAAAA,GAAG,GAAGF,EAAE,CAACG,CAAD,CAAR;;AACA,QAAI,CAACtB,SAAS,CAACC,CAAC,CAACoB,GAAD,CAAF,EAASnB,CAAC,CAACmB,GAAD,CAAV,CAAd,EAAgC;AAC9B,aAAO,KAAP;AACD;AACF;;AAED,SAAO,IAAP;AACD,CAxFD;AA0FA;;;;;AAIAzB,OAAO,CAACgC,IAAR,GAAe,UAASC,GAAT,EAAc;AAC3B,MAAIA,GAAG,CAACH,MAAJ,GAAa,CAAjB,EAAoB;AAClB,WAAOG,GAAG,CAACA,GAAG,CAACH,MAAJ,GAAa,CAAd,CAAV;AACD;;AACD,SAAO,KAAK,CAAZ;AACD,CALD;;AAOA9B,OAAO,CAACR,KAAR,GAAgBA,KAAhB;AAEA;;;;AAIAQ,OAAO,CAACH,iBAAR,GAA4BA,iBAA5B;AAEA;;;;AAIAG,OAAO,CAACkC,IAAR,GAAe,SAASA,IAAT,CAAcC,GAAd,EAAmBP,IAAnB,EAAyB;AACtC,MAAIA,IAAI,IAAI,IAAZ,EAAkB;AAChB,WAAOD,MAAM,CAACS,MAAP,CAAc,EAAd,EAAkBD,GAAlB,CAAP;AACD;;AACD,MAAI,CAACE,KAAK,CAACC,OAAN,CAAcV,IAAd,CAAL,EAA0B;AACxBA,IAAAA,IAAI,GAAG,CAACA,IAAD,CAAP;AACD;;AAED,QAAMW,GAAG,GAAGZ,MAAM,CAACS,MAAP,CAAc,EAAd,EAAkBD,GAAlB,CAAZ;;AACA,OAAK,MAAMV,GAAX,IAAkBG,IAAlB,EAAwB;AACtB,WAAOW,GAAG,CAACd,GAAD,CAAV;AACD;;AACD,SAAOc,GAAP;AACD,CAbD;AAgBA;;;;;;;;;;AASAvC,OAAO,CAACwC,OAAR,GAAkB,UAASC,QAAT,EAAmBD,OAAnB,EAA4B;AAC5C,QAAMZ,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYa,QAAZ,CAAb;AACA,MAAIf,CAAC,GAAGE,IAAI,CAACE,MAAb;AACA,MAAIY,CAAJ;AAEAF,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;;AAEA,SAAOd,CAAC,EAAR,EAAY;AACVgB,IAAAA,CAAC,GAAGd,IAAI,CAACF,CAAD,CAAR;;AACA,QAAI,EAAEgB,CAAC,IAAIF,OAAP,CAAJ,EAAqB;AACnBA,MAAAA,OAAO,CAACE,CAAD,CAAP,GAAaD,QAAQ,CAACC,CAAD,CAArB;AACD;AACF;;AAED,SAAOF,OAAP;AACD,CAfD;AAiBA;;;;;;;AAMAxC,OAAO,CAAC2C,MAAR,GAAiB,YAAW;AAC1B,SAAOC,IAAI,CAACD,MAAL,GAAclC,QAAd,GAAyBoC,MAAzB,CAAgC,CAAhC,CAAP;AACD,CAFD;AAIA;;;;;;;;;AAQA7C,OAAO,CAAC8C,KAAR,GAAgB,SAASA,KAAT,CAAeC,EAAf,EAAmBC,IAAnB,EAAyBR,OAAzB,EAAkCS,IAAlC,EAAwC;AACtDT,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEA,QAAMZ,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYoB,IAAZ,CAAb;AACA,MAAItB,CAAC,GAAG,CAAR;AACA,QAAMwB,GAAG,GAAGtB,IAAI,CAACE,MAAjB;AACA,MAAIL,GAAJ;AAEAwB,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;AACA,QAAME,UAAU,GAAGX,OAAO,CAACW,UAAR,IAAsB,EAAzC;;AAEA,SAAOzB,CAAC,GAAGwB,GAAX,EAAgB;AACdzB,IAAAA,GAAG,GAAGG,IAAI,CAACF,CAAC,EAAF,CAAV;;AACA,QAAIc,OAAO,CAACN,IAAR,IAAgBM,OAAO,CAACN,IAAR,CAAaT,GAAb,CAApB,EAAuC;AACrC;AACD;;AACD,QAAI0B,UAAU,CAACF,IAAD,CAAd,EAAsB;AACpB;AACD;;AACD,QAAInD,iBAAiB,CAACsD,GAAlB,CAAsB3B,GAAtB,CAAJ,EAAgC;AAC9B;AACD;;AACD,QAAIsB,EAAE,CAACtB,GAAD,CAAF,IAAW,IAAf,EAAqB;AACnBsB,MAAAA,EAAE,CAACtB,GAAD,CAAF,GAAUuB,IAAI,CAACvB,GAAD,CAAd;AACD,KAFD,MAEO,IAAIzB,OAAO,CAACP,QAAR,CAAiBuD,IAAI,CAACvB,GAAD,CAArB,CAAJ,EAAiC;AACtC,UAAI,CAACzB,OAAO,CAACP,QAAR,CAAiBsD,EAAE,CAACtB,GAAD,CAAnB,CAAL,EAAgC;AAC9BsB,QAAAA,EAAE,CAACtB,GAAD,CAAF,GAAU,EAAV;AACD;;AACD,UAAIuB,IAAI,CAACvB,GAAD,CAAJ,IAAa,IAAjB,EAAuB;AACrB,YAAIuB,IAAI,CAACvB,GAAD,CAAJ,CAAU4B,gBAAd,EAAgC;AAC9B,cAAIN,EAAE,CAACtB,GAAD,CAAF,CAAQ4B,gBAAZ,EAA8B;AAC5BN,YAAAA,EAAE,CAACtB,GAAD,CAAF,CAAQ6B,GAAR,CAAYN,IAAI,CAACvB,GAAD,CAAJ,CAAUjC,KAAV,EAAZ;AACD,WAFD,MAEO;AACLuD,YAAAA,EAAE,CAACtB,GAAD,CAAF,GAAUuB,IAAI,CAACvB,GAAD,CAAJ,CAAUjC,KAAV,EAAV;AACD;;AACD;AACD,SAPD,MAOO,IAAIwD,IAAI,CAACvB,GAAD,CAAJ,YAAqBnC,QAAzB,EAAmC;AACxCyD,UAAAA,EAAE,CAACtB,GAAD,CAAF,GAAU,IAAInC,QAAJ,CAAa0D,IAAI,CAACvB,GAAD,CAAjB,CAAV;AACA;AACD;AACF;;AACDqB,MAAAA,KAAK,CAACC,EAAE,CAACtB,GAAD,CAAH,EAAUuB,IAAI,CAACvB,GAAD,CAAd,EAAqBe,OAArB,EAA8BS,IAAI,GAAGA,IAAI,GAAG,GAAP,GAAaxB,GAAhB,GAAsBA,GAAxD,CAAL;AACD,KAlBM,MAkBA,IAAIe,OAAO,CAACe,SAAZ,EAAuB;AAC5BR,MAAAA,EAAE,CAACtB,GAAD,CAAF,GAAUuB,IAAI,CAACvB,GAAD,CAAd;AACD;AACF;AACF,CA9CD;AAgDA;;;;;;;;;AAQAzB,OAAO,CAACsB,QAAR,GAAmB,SAASA,QAAT,CAAkBa,GAAlB,EAAuB;AACxCpC,EAAAA,QAAQ,KAAKA,QAAQ,GAAGd,OAAO,CAAC,YAAD,CAAvB,CAAR;AACA,MAAIsD,GAAJ;;AAEA,MAAIJ,GAAG,IAAI,IAAX,EAAiB;AACf,WAAOA,GAAP;AACD;;AAED,MAAIA,GAAG,YAAYpC,QAAnB,EAA6B;AAC3B,WAAOoC,GAAG,CAACb,QAAJ,EAAP;AACD;;AAED,MAAIe,KAAK,CAACC,OAAN,CAAcH,GAAd,CAAJ,EAAwB;AACtBI,IAAAA,GAAG,GAAG,EAAN;;AAEA,SAAK,MAAMiB,GAAX,IAAkBrB,GAAlB,EAAuB;AACrBI,MAAAA,GAAG,CAACkB,IAAJ,CAASnC,QAAQ,CAACkC,GAAD,CAAjB;AACD;;AAED,WAAOjB,GAAP;AACD;;AAED,MAAIvC,OAAO,CAAC0D,MAAR,CAAevB,GAAf,CAAJ,EAAyB;AACvBI,IAAAA,GAAG,GAAG,EAAN;;AAEA,SAAK,MAAMG,CAAX,IAAgBP,GAAhB,EAAqB;AACnB,UAAIrC,iBAAiB,CAACsD,GAAlB,CAAsBV,CAAtB,CAAJ,EAA8B;AAC5B;AACD;;AACDH,MAAAA,GAAG,CAACG,CAAD,CAAH,GAASpB,QAAQ,CAACa,GAAG,CAACO,CAAD,CAAJ,CAAjB;AACD;;AAED,WAAOH,GAAP;AACD;;AAED,SAAOJ,GAAP;AACD,CApCD;;AAsCAnC,OAAO,CAACP,QAAR,GAAmBA,QAAnB;AAEA;;;;;;;;;;;;AAYAO,OAAO,CAAC0D,MAAR,GAAiB,SAASA,MAAT,CAAgBC,GAAhB,EAAqB;AACpC,MAAIA,GAAG,IAAI,IAAP,IAAe,OAAOA,GAAP,KAAe,QAAlC,EAA4C;AAC1C,WAAO,KAAP;AACD;;AACD,QAAMC,KAAK,GAAGjC,MAAM,CAACkC,cAAP,CAAsBF,GAAtB,CAAd,CAJoC,CAKpC;AACA;AACA;;AACA,SAAO,CAACC,KAAD,IAAUA,KAAK,CAACE,WAAN,CAAkB5D,IAAlB,KAA2B,QAA5C;AACD,CATD;AAWA;;;;;;AAKAF,OAAO,CAAC+D,cAAR,GAAyB,UAASJ,GAAT,EAAc;AACrC,SAAOtB,KAAK,CAACC,OAAN,CAAcqB,GAAd,KACLA,GAAG,YAAYpD,IADV,IAELoD,GAAG,YAAYK,OAFV,IAGLL,GAAG,YAAY1C,MAHV,IAIL0C,GAAG,YAAYM,MAJjB;AAKD,CAND;AAQA;;;;;AAIAjE,OAAO,CAACkE,aAAR,GAAwB,UAASC,GAAT,EAAc;AACpC,SAAOA,GAAG,IAAI,IAAP,IACL,OAAOA,GAAP,KAAe,QADV,IAELxC,MAAM,CAACC,IAAP,CAAYuC,GAAZ,EAAiBrC,MAAjB,KAA4B,CAF9B;AAGD,CAJD;AAMA;;;;;;AAKA9B,OAAO,CAACoE,MAAR,GAAiB,SAASA,MAAT,CAAgBjC,GAAhB,EAAqBV,GAArB,EAA0B;AACzC,QAAM4C,KAAK,GAAG1C,MAAM,CAACC,IAAP,CAAYO,GAAZ,CAAd;;AACA,OAAK,MAAMmC,IAAX,IAAmBD,KAAnB,EAA0B;AACxB,QAAIC,IAAI,KAAK7C,GAAb,EAAkB;AAChB,aAAO,IAAP;AACD;;AACD,QAAIzB,OAAO,CAAC0D,MAAR,CAAevB,GAAG,CAACmC,IAAD,CAAlB,KAA6BtE,OAAO,CAACoE,MAAR,CAAejC,GAAG,CAACmC,IAAD,CAAlB,EAA0B7C,GAA1B,CAAjC,EAAiE;AAC/D,aAAO,IAAP;AACD;AACF;;AACD,SAAO,KAAP;AACD,CAXD;AAaA;;;;;;AAKAzB,OAAO,CAACuE,IAAR,GAAepF,MAAf;AAEA;;;;;;;;;;;AAWAa,OAAO,CAACwE,IAAR,GAAe,SAASA,IAAT,CAAcC,QAAd,EAAwB;AACrC,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClC;AACD;;AACD,SAAO,YAAW;AAChB,QAAI;AACFA,MAAAA,QAAQ,CAACC,KAAT,CAAe,IAAf,EAAqBC,SAArB;AACD,KAFD,CAEE,OAAOC,GAAP,EAAY;AACZ;AACA;AACAC,MAAAA,OAAO,CAACC,QAAR,CAAiB,YAAW;AAC1B,cAAMF,GAAN;AACD,OAFD;AAGD;AACF,GAVD;AAWD,CAfD;AAiBA;;;;;;AAKA5E,OAAO,CAAC+E,cAAR,GAAyB,UAASC,CAAT,EAAY;AACnC,SAAOA,CAAC,YAAY1F,QAAb,IAAyB0F,CAAC,YAAY3F,OAAtC,IAAiD2F,CAAC,YAAY5F,MAArE;AACD,CAFD;;AAIAY,OAAO,CAACJ,gBAAR,GAA2BA,gBAA3B;AAEA;;;;;;;AAOAI,OAAO,CAACiF,OAAR,GAAkB,SAASA,OAAT,CAAiBC,MAAjB,EAAyB;AACzC,MAAI,EAAEA,MAAM,IAAIA,MAAM,CAACpB,WAAP,CAAmB5D,IAAnB,KAA4B,QAAxC,CAAJ,EAAuD;AACrD;AACD;;AACD,MAAI,EAAE,aAAagF,MAAf,CAAJ,EAA4B;AAC1B;AACD;;AAED,MAAIC,IAAJ;;AACA,MAAI,OAAOD,MAAM,CAACD,OAAd,KAA0B,QAA9B,EAAwC;AACtCE,IAAAA,IAAI,GAAGD,MAAM,CAACD,OAAd;AACD,GAFD,MAEO;AACLE,IAAAA,IAAI,GAAGvC,IAAI,CAACwC,KAAL,CAAWpG,EAAE,CAACkG,MAAM,CAACD,OAAR,CAAF,GAAqB,IAAhC,CAAP;AACD;;AACDC,EAAAA,MAAM,CAACG,kBAAP,GAA4BF,IAA5B;AACA,SAAOD,MAAM,CAACD,OAAd;AACD,CAhBD;AAkBA;;;;;AAIAjF,OAAO,CAACsF,QAAR,GAAmB,SAASA,QAAT,CAAkBrC,IAAlB,EAAwBsC,MAAxB,EAAgCC,KAAhC,EAAuCC,KAAvC,EAA8CjD,OAA9C,EAAuDkD,WAAvD,EAAoEC,OAApE,EAA6EC,KAA7E,EAAoF;AACrG;AACA,MAAIzD,GAAG,GAAG,IAAV;;AACA,MAAIwC,SAAS,CAAC7C,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,QAAImB,IAAI,YAAY1D,eAApB,EAAqC;AACnC,aAAO,CAAC0D,IAAD,CAAP;AACD;;AAED,QAAIZ,KAAK,CAACC,OAAN,CAAcW,IAAd,CAAJ,EAAyB;AACvB,YAAM4C,OAAO,GAAGC,WAAW,CAAC7C,IAAD,CAA3B;AACA,aAAO4C,OAAO,CAACE,GAAR,CAAYC,CAAC,IAAIhG,OAAO,CAACsF,QAAR,CAAiBU,CAAjB,EAAoB,CAApB,CAAjB,CAAP;AACD;;AAED,QAAIhG,OAAO,CAACP,QAAR,CAAiBwD,IAAjB,CAAJ,EAA4B;AAC1Bd,MAAAA,GAAG,GAAGR,MAAM,CAACS,MAAP,CAAc,EAAd,EAAkBa,IAAlB,CAAN;AACD,KAFD,MAEO;AACLd,MAAAA,GAAG,GAAG;AAAEc,QAAAA,IAAI,EAAEA;AAAR,OAAN;AACD;AACF,GAfD,MAeO,IAAI,OAAOuC,KAAP,KAAiB,QAArB,EAA+B;AACpCrD,IAAAA,GAAG,GAAG;AACJc,MAAAA,IAAI,EAAEA,IADF;AAEJsC,MAAAA,MAAM,EAAEA,MAFJ;AAGJE,MAAAA,KAAK,EAAED,KAHH;AAIJhD,MAAAA,OAAO,EAAEiD;AAJL,KAAN;AAMD,GAPM,MAOA;AACLtD,IAAAA,GAAG,GAAG;AACJc,MAAAA,IAAI,EAAEA,IADF;AAEJsC,MAAAA,MAAM,EAAEA,MAFJ;AAGJC,MAAAA,KAAK,EAAEA,KAHH;AAIJC,MAAAA,KAAK,EAAEA,KAJH;AAKJjD,MAAAA,OAAO,EAAEA,OALL;AAMJ8C,MAAAA,QAAQ,EAAEI,WANN;AAOJC,MAAAA,OAAO,EAAEA,OAPL;AAQJC,MAAAA,KAAK,EAAEA;AARH,KAAN;AAUD;;AAED,MAAI,OAAOzD,GAAG,CAACc,IAAX,KAAoB,QAAxB,EAAkC;AAChC,UAAM,IAAIgD,SAAJ,CAAc,gEAAgE,OAAOhD,IAAvE,GAA8E,GAA5F,CAAN;AACD;;AAED,SAAOiD,YAAY,CAAC/D,GAAD,CAAnB,CA1CqG,CA4CrG;AACA;AACA;;AACA,WAAS2D,WAAT,CAAqB7D,GAArB,EAA0B;AACxB,UAAMM,GAAG,GAAG,EAAZ;AACAN,IAAAA,GAAG,CAACkE,OAAJ,CAAY,UAAShE,GAAT,EAAc;AACxB,UAAI,OAAOiE,IAAP,CAAYjE,GAAG,CAACc,IAAhB,CAAJ,EAA2B;AACzB,cAAMoD,KAAK,GAAGlE,GAAG,CAACc,IAAJ,CAASqD,KAAT,CAAe,GAAf,CAAd;AACAD,QAAAA,KAAK,CAACF,OAAN,CAAc,UAASI,CAAT,EAAY;AACxB,gBAAMC,IAAI,GAAG7E,MAAM,CAACS,MAAP,CAAc,EAAd,EAAkBD,GAAlB,CAAb;AACAqE,UAAAA,IAAI,CAACvD,IAAL,GAAYsD,CAAZ;AACAhE,UAAAA,GAAG,CAACkB,IAAJ,CAAS+C,IAAT;AACD,SAJD;AAKD,OAPD,MAOO;AACLjE,QAAAA,GAAG,CAACkB,IAAJ,CAAStB,GAAT;AACD;AACF,KAXD;AAaA,WAAOI,GAAP;AACD;AACF,CAhED;;AAkEA,SAAS2D,YAAT,CAAsB/D,GAAtB,EAA2B;AACzB,MAAIE,KAAK,CAACC,OAAN,CAAcH,GAAG,CAACmD,QAAlB,CAAJ,EAAiC;AAC/B,UAAM/C,GAAG,GAAG,EAAZ;AACAJ,IAAAA,GAAG,CAACmD,QAAJ,CAAaa,OAAb,CAAqB,UAAShE,GAAT,EAAc;AACjC,UAAI,OAAOiE,IAAP,CAAYjE,GAAG,CAACc,IAAhB,CAAJ,EAA2B;AACzB,cAAMuD,IAAI,GAAG7E,MAAM,CAACS,MAAP,CAAc,EAAd,EAAkBD,GAAlB,CAAb;AACA,cAAMkE,KAAK,GAAGG,IAAI,CAACvD,IAAL,CAAUqD,KAAV,CAAgB,GAAhB,CAAd;AACAD,QAAAA,KAAK,CAACF,OAAN,CAAc,UAASI,CAAT,EAAY;AACxBC,UAAAA,IAAI,CAACvD,IAAL,GAAYsD,CAAZ;AACAhE,UAAAA,GAAG,CAACkB,IAAJ,CAASzD,OAAO,CAACsF,QAAR,CAAiBkB,IAAjB,EAAuB,CAAvB,CAAT;AACD,SAHD;AAID,OAPD,MAOO;AACLjE,QAAAA,GAAG,CAACkB,IAAJ,CAASzD,OAAO,CAACsF,QAAR,CAAiBnD,GAAjB,EAAsB,CAAtB,CAAT;AACD;AACF,KAXD;AAYAA,IAAAA,GAAG,CAACmD,QAAJ,GAAetF,OAAO,CAACsF,QAAR,CAAiB/C,GAAjB,CAAf;AACD,GAfD,MAeO,IAAIJ,GAAG,CAACmD,QAAJ,IAAgB,IAAhB,IAAwB,OAAOnD,GAAG,CAACmD,QAAX,KAAwB,QAApD,EAA8D;AACnEnD,IAAAA,GAAG,CAACmD,QAAJ,GAAetF,OAAO,CAACsF,QAAR,CAAiBnD,GAAG,CAACmD,QAArB,CAAf;AACD;;AAED,QAAM/C,GAAG,GAAG,EAAZ;AACA,QAAM8D,KAAK,GAAGlE,GAAG,CAACc,IAAJ,CAASqD,KAAT,CAAe,GAAf,CAAd;;AACA,MAAInE,GAAG,CAACK,OAAJ,IAAe,IAAnB,EAAyB;AACvBL,IAAAA,GAAG,CAACK,OAAJ,GAAcxC,OAAO,CAACR,KAAR,CAAc2C,GAAG,CAACK,OAAlB,CAAd;AACD;;AAED,OAAK,MAAMS,IAAX,IAAmBoD,KAAnB,EAA0B;AACxB9D,IAAAA,GAAG,CAACkB,IAAJ,CAAS,IAAIlE,eAAJ,CAAoBoC,MAAM,CAACS,MAAP,CAAc,EAAd,EAAkBD,GAAlB,EAAuB;AAAEc,MAAAA,IAAI,EAAEA;AAAR,KAAvB,CAApB,CAAT;AACD;;AAED,SAAOV,GAAP;AACD;AAED;;;;;;;;AAOAvC,OAAO,CAACyG,QAAR,GAAmB,UAASxD,IAAT,EAAed,GAAf,EAAoB4D,GAApB,EAAyB;AAC1C,SAAO7G,KAAK,CAACwH,GAAN,CAAUzD,IAAV,EAAgBd,GAAhB,EAAqB,MAArB,EAA6B4D,GAA7B,CAAP;AACD,CAFD;AAIA;;;;;;;;;AAQA/F,OAAO,CAAC2G,QAAR,GAAmB,UAAS1D,IAAT,EAAekB,GAAf,EAAoBhC,GAApB,EAAyB4D,GAAzB,EAA8Ba,QAA9B,EAAwC;AACzD1H,EAAAA,KAAK,CAAC2H,GAAN,CAAU5D,IAAV,EAAgBkB,GAAhB,EAAqBhC,GAArB,EAA0B,MAA1B,EAAkC4D,GAAlC,EAAuCa,QAAvC;AACD,CAFD;AAIA;;;;;;;;;AAQA5G,OAAO,CAACkF,MAAR,GAAiB,EAAjB;;AACAlF,OAAO,CAACkF,MAAR,CAAe4B,IAAf,GAAsB,SAASA,IAAT,CAAcd,CAAd,EAAiB;AACrC,QAAMpE,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYoE,CAAZ,CAAb;AACA,MAAItE,CAAC,GAAGE,IAAI,CAACE,MAAb;AACA,QAAMS,GAAG,GAAG,EAAZ;;AAEA,SAAOb,CAAC,EAAR,EAAY;AACVa,IAAAA,GAAG,CAACkB,IAAJ,CAASuC,CAAC,CAACpE,IAAI,CAACF,CAAD,CAAL,CAAV;AACD;;AAED,SAAOa,GAAP;AACD,CAVD;AAYA;;;;;AAIAvC,OAAO,CAACkF,MAAR,CAAe6B,WAAf,GAA6B/G,OAAO,CAACwC,OAArC;AAEA;;;;;;;AAOA,MAAMwE,GAAG,GAAGrF,MAAM,CAACX,SAAP,CAAiBiG,cAA7B;;AACAjH,OAAO,CAACkF,MAAR,CAAe+B,cAAf,GAAgC,UAAS9E,GAAT,EAAcmC,IAAd,EAAoB;AAClD,SAAO0C,GAAG,CAACE,IAAJ,CAAS/E,GAAT,EAAcmC,IAAd,CAAP;AACD,CAFD;AAIA;;;;;;;AAMAtE,OAAO,CAACmH,iBAAR,GAA4B,UAAShD,GAAT,EAAc;AACxC,SAAOA,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAKpD,SAA/B;AACD,CAFD;AAIA;;;;;AAIAf,OAAO,CAACoH,KAAR,GAAgB,EAAhB;AAEA;;;;;;;;;;;AAWApH,OAAO,CAACoH,KAAR,CAAcC,OAAd,GAAwB,SAASA,OAAT,CAAiBpF,GAAjB,EAAsBqF,MAAtB,EAA8B/E,GAA9B,EAAmC;AACzDA,EAAAA,GAAG,KAAKA,GAAG,GAAG,EAAX,CAAH;AAEAN,EAAAA,GAAG,CAACkE,OAAJ,CAAY,UAASoB,IAAT,EAAe;AACzB,QAAIlF,KAAK,CAACC,OAAN,CAAciF,IAAd,CAAJ,EAAyB;AACvBF,MAAAA,OAAO,CAACE,IAAD,EAAOD,MAAP,EAAe/E,GAAf,CAAP;AACD,KAFD,MAEO;AACL,UAAI,CAAC+E,MAAD,IAAWA,MAAM,CAACC,IAAD,CAArB,EAA6B;AAC3BhF,QAAAA,GAAG,CAACkB,IAAJ,CAAS8D,IAAT;AACD;AACF;AACF,GARD;AAUA,SAAOhF,GAAP;AACD,CAdD;AAgBA;;;;;AAIA,MAAMiF,eAAe,GAAG7F,MAAM,CAACX,SAAP,CAAiBiG,cAAzC;;AAEAjH,OAAO,CAACyH,sBAAR,GAAiC,UAAStF,GAAT,EAAcV,GAAd,EAAmB;AAClD,MAAIU,GAAG,IAAI,IAAX,EAAiB;AACf,WAAO,KAAP;AACD;;AAED,MAAIE,KAAK,CAACC,OAAN,CAAcb,GAAd,CAAJ,EAAwB;AACtB,SAAK,MAAMiB,CAAX,IAAgBjB,GAAhB,EAAqB;AACnB,UAAIzB,OAAO,CAACyH,sBAAR,CAA+BtF,GAA/B,EAAoCO,CAApC,CAAJ,EAA4C;AAC1C,eAAO,IAAP;AACD;AACF;;AACD,WAAO,KAAP;AACD;;AAED,MAAI8E,eAAe,CAACN,IAAhB,CAAqB/E,GAArB,EAA0BV,GAA1B,CAAJ,EAAoC;AAClC,WAAO,IAAP;AACD;;AACD,MAAI,OAAOU,GAAP,KAAe,QAAf,IAA2BV,GAAG,IAAIU,GAAtC,EAA2C;AACzC,UAAM6C,CAAC,GAAG7C,GAAG,CAACV,GAAD,CAAb;AACA,WAAOuD,CAAC,KAAKrD,MAAM,CAACX,SAAP,CAAiBS,GAAjB,CAAN,IAA+BuD,CAAC,KAAK3C,KAAK,CAACrB,SAAN,CAAgBS,GAAhB,CAA5C;AACD;;AAED,SAAO,KAAP;AACD,CAvBD;AAyBA;;;;;AAIA,MAAMiG,eAAe,GAAG9E,IAAI,CAAC+E,GAAL,CAAS,CAAT,EAAY,EAAZ,IAAkB,CAA1C;;AAEA3H,OAAO,CAAC4H,YAAR,GAAuB,UAASzD,GAAT,EAAc;AACnC,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AAC3B,WAAOA,GAAG,IAAI,CAAP,IAAYA,GAAG,IAAIuD,eAA1B;AACD;;AACD,MAAI,OAAOvD,GAAP,KAAe,QAAnB,EAA6B;AAC3B,QAAI,CAAC,QAAQiC,IAAR,CAAajC,GAAb,CAAL,EAAwB;AACtB,aAAO,KAAP;AACD;;AACDA,IAAAA,GAAG,GAAG,CAACA,GAAP;AACA,WAAOA,GAAG,IAAI,CAAP,IAAYA,GAAG,IAAIuD,eAA1B;AACD;;AAED,SAAO,KAAP;AACD,CAbD;AAeA;;;;;;;;;;;;;AAYA1H,OAAO,CAACoH,KAAR,CAAcS,MAAd,GAAuB,UAAS5F,GAAT,EAAc;AACnC,QAAM6F,UAAU,GAAG,EAAnB;AACA,QAAMC,GAAG,GAAG,EAAZ;AACA,QAAMxF,GAAG,GAAG,EAAZ;;AAEA,OAAK,MAAMgF,IAAX,IAAmBtF,GAAnB,EAAwB;AACtB,QAAI,OAAOsF,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,IAAP,KAAgB,QAA5C,IAAwDA,IAAI,IAAI,IAApE,EAA0E;AACxE,UAAIO,UAAU,CAACP,IAAD,CAAd,EAAsB;AACpB;AACD;;AACDhF,MAAAA,GAAG,CAACkB,IAAJ,CAAS8D,IAAT;AACAO,MAAAA,UAAU,CAACP,IAAD,CAAV,GAAmB,IAAnB;AACD,KAND,MAMO,IAAIA,IAAI,YAAYjI,QAApB,EAA8B;AACnC,UAAIyI,GAAG,CAACR,IAAI,CAAC9G,QAAL,EAAD,CAAP,EAA0B;AACxB;AACD;;AACD8B,MAAAA,GAAG,CAACkB,IAAJ,CAAS8D,IAAT;AACAQ,MAAAA,GAAG,CAACR,IAAI,CAAC9G,QAAL,EAAD,CAAH,GAAuB,IAAvB;AACD,KANM,MAMA;AACL8B,MAAAA,GAAG,CAACkB,IAAJ,CAAS8D,IAAT;AACD;AACF;;AAED,SAAOhF,GAAP;AACD,CAxBD;AA0BA;;;;;;;;AAOAvC,OAAO,CAACoB,MAAR,GAAiB,EAAjB;;AACApB,OAAO,CAACoB,MAAR,CAAeC,QAAf,GAA0B,UAAShB,CAAT,EAAYC,CAAZ,EAAe;AACvC,MAAI,CAAClB,MAAM,CAAC+B,QAAP,CAAgBd,CAAhB,CAAL,EAAyB;AACvB,WAAO,KAAP;AACD;;AACD,MAAI,CAACjB,MAAM,CAAC+B,QAAP,CAAgBb,CAAhB,CAAL,EAAyB;AACvB,WAAO,KAAP;AACD;;AACD,MAAID,CAAC,CAACyB,MAAF,KAAaxB,CAAC,CAACwB,MAAnB,EAA2B;AACzB,WAAO,KAAP;AACD;;AACD,OAAK,IAAIJ,CAAC,GAAG,CAAR,EAAWwB,GAAG,GAAG7C,CAAC,CAACyB,MAAxB,EAAgCJ,CAAC,GAAGwB,GAApC,EAAyC,EAAExB,CAA3C,EAA8C;AAC5C,QAAIrB,CAAC,CAACqB,CAAD,CAAD,KAASpB,CAAC,CAACoB,CAAD,CAAd,EAAmB;AACjB,aAAO,KAAP;AACD;AACF;;AACD,SAAO,IAAP;AACD,CAhBD;;AAkBA1B,OAAO,CAACL,eAAR,GAA0BA,eAA1B;AACA;;;;AAIAK,OAAO,CAACgI,QAAR,GAAmB,UAASC,WAAT,EAAsBtH,MAAtB,EAA8B;AAC/C,OAAK,MAAMc,GAAX,IAAkBd,MAAlB,EAA0B;AACxB,QAAIb,iBAAiB,CAACsD,GAAlB,CAAsB3B,GAAtB,CAAJ,EAAgC;AAC9B;AACD;;AACDwG,IAAAA,WAAW,CAACxG,GAAD,CAAX,GAAmBd,MAAM,CAACc,GAAD,CAAzB;AACD;AACF,CAPD;AASA;;;;;;;;;AAQAzB,OAAO,CAACkI,UAAR,GAAqB,UAASnF,EAAT,EAAaoF,OAAb,EAAsB;AACzC,MAAIvI,gBAAgB,CAACuI,OAAD,CAApB,EAA+B;AAC7BA,IAAAA,OAAO,GAAGA,OAAO,CAAC7G,QAAR,CAAiB;AACzB8G,MAAAA,SAAS,EAAE,KADc;AAEzBC,MAAAA,QAAQ,EAAE,KAFe;AAGzBC,MAAAA,UAAU,EAAE,IAHa;AAIzBC,MAAAA,OAAO,EAAE,KAJgB;AAKzBC,MAAAA,eAAe,EAAE;AALQ,KAAjB,CAAV;AAOD;;AACD,QAAM5G,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYuG,OAAZ,CAAb;AACA,QAAMjF,GAAG,GAAGtB,IAAI,CAACE,MAAjB;AACA,MAAIJ,CAAC,GAAG,CAAR;AACA,MAAID,GAAJ;;AAEA,SAAOC,CAAC,GAAGwB,GAAX,EAAgB;AACdzB,IAAAA,GAAG,GAAGG,IAAI,CAACF,CAAC,EAAF,CAAV;;AACA,QAAI5B,iBAAiB,CAACsD,GAAlB,CAAsB3B,GAAtB,CAAJ,EAAgC;AAC9B;AACD;;AACD,QAAI,OAAOsB,EAAE,CAACtB,GAAD,CAAT,KAAmB,WAAvB,EAAoC;AAClCsB,MAAAA,EAAE,CAACtB,GAAD,CAAF,GAAUzB,OAAO,CAACR,KAAR,CAAc2I,OAAO,CAAC1G,GAAD,CAArB,EAA4B;AACpC2G,QAAAA,SAAS,EAAE,KADyB;AAEpCC,QAAAA,QAAQ,EAAE,KAF0B;AAGpCC,QAAAA,UAAU,EAAE,IAHwB;AAIpCC,QAAAA,OAAO,EAAE,KAJ2B;AAKpCC,QAAAA,eAAe,EAAE;AALmB,OAA5B,CAAV;AAOD,KARD,MAQO;AACL,UAAIrE,GAAG,GAAGgE,OAAO,CAAC1G,GAAD,CAAjB;;AACA,UAAI0C,GAAG,IAAI,IAAP,IAAeA,GAAG,CAACjD,OAAnB,IAA8B,EAAEiD,GAAG,YAAY5D,IAAjB,CAAlC,EAA0D;AACxD4D,QAAAA,GAAG,GAAGA,GAAG,CAACjD,OAAJ,EAAN;AACD;;AACD,UAAIlB,OAAO,CAACP,QAAR,CAAiB0E,GAAjB,CAAJ,EAA2B;AACzB,YAAIhC,GAAG,GAAGgC,GAAV;;AACA,YAAIvE,gBAAgB,CAACuE,GAAD,CAAhB,IAAyB,CAACA,GAAG,CAACsE,gBAAlC,EAAoD;AAClDtG,UAAAA,GAAG,GAAGA,GAAG,CAACb,QAAJ,CAAa;AACjB8G,YAAAA,SAAS,EAAE,KADM;AAEjBC,YAAAA,QAAQ,EAAE,KAFO;AAGjBC,YAAAA,UAAU,EAAE,IAHK;AAIjBC,YAAAA,OAAO,EAAE,KAJQ;AAKjBC,YAAAA,eAAe,EAAE;AALA,WAAb,CAAN;AAOD;;AACD,YAAIrE,GAAG,CAACsE,gBAAR,EAA0B;AACxBtG,UAAAA,GAAG,GAAG/C,MAAM,CAAC4D,IAAP,CAAYb,GAAZ,CAAN;AACD;;AACDnC,QAAAA,OAAO,CAACkI,UAAR,CAAmBnF,EAAE,CAACtB,GAAD,CAArB,EAA4BU,GAA5B;AACD,OAfD,MAeO;AACLY,QAAAA,EAAE,CAACtB,GAAD,CAAF,GAAUzB,OAAO,CAACR,KAAR,CAAc2E,GAAd,EAAmB;AAC3BqE,UAAAA,eAAe,EAAE;AADU,SAAnB,CAAV;AAGD;AACF;AACF;AACF,CAvDD;AAyDA;;;;;;;;;AAQAxI,OAAO,CAAC0I,IAAR,GAAe,UAASzG,GAAT,EAAc0G,EAAd,EAAkB;AAC/B,OAAK,MAAMpB,IAAX,IAAmBtF,GAAnB,EAAwB;AACtB0G,IAAAA,EAAE,CAACpB,IAAD,CAAF;AACD;AACF,CAJD;AAMA;;;;;AAIAvH,OAAO,CAAC4I,SAAR,GAAoB,UAAS1I,IAAT,EAAe;AACjC,QAAM2I,OAAO,GAAGxG,KAAK,CAACrB,SAAN,CAAgB8H,KAAhB,CAAsB5B,IAAtB,CAA2BvC,SAA3B,EAAsC,CAAtC,CAAhB;;AAEA,OAAK,MAAMhE,MAAX,IAAqBkI,OAArB,EAA8B;AAC5B,QAAIlI,MAAM,CAACT,IAAD,CAAN,IAAgB,IAApB,EAA0B;AACxB,aAAOS,MAAM,CAACT,IAAD,CAAb;AACD;AACF;;AAED,SAAO,IAAP;AACD,CAVD;AAYA;;;;;AAIAF,OAAO,CAAC+I,IAAR,GAAe,YAAW,CAAE,CAA5B","sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nconst ms = require('ms');\nconst mpath = require('mpath');\nconst sliced = require('sliced');\nconst Buffer = require('safe-buffer').Buffer;\nconst Decimal = require('./types/decimal128');\nconst ObjectId = require('./types/objectid');\nconst PopulateOptions = require('./options/PopulateOptions');\nconst clone = require('./helpers/clone');\nconst isObject = require('./helpers/isObject');\nconst isBsonType = require('./helpers/isBsonType');\nconst getFunctionName = require('./helpers/getFunctionName');\nconst isMongooseObject = require('./helpers/isMongooseObject');\nconst promiseOrCallback = require('./helpers/promiseOrCallback');\nconst specialProperties = require('./helpers/specialProperties');\n\nlet Document;\n\nexports.specialProperties = specialProperties;\n\n/*!\n * Produces a collection name from model `name`. By default, just returns\n * the model name\n *\n * @param {String} name a model name\n * @param {Function} pluralize function that pluralizes the collection name\n * @return {String} a collection name\n * @api private\n */\n\nexports.toCollectionName = function(name, pluralize) {\n  if (name === 'system.profile') {\n    return name;\n  }\n  if (name === 'system.indexes') {\n    return name;\n  }\n  if (typeof pluralize === 'function') {\n    return pluralize(name);\n  }\n  return name;\n};\n\n/*!\n * Determines if `a` and `b` are deep equal.\n *\n * Modified from node/lib/assert.js\n *\n * @param {any} a a value to compare to `b`\n * @param {any} b a value to compare to `a`\n * @return {Boolean}\n * @api private\n */\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n\n  if ((isBsonType(a, 'ObjectID') && isBsonType(b, 'ObjectID')) ||\n      (isBsonType(a, 'Decimal128') && isBsonType(b, 'Decimal128'))) {\n    return a.toString() === b.toString();\n  }\n\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source &&\n        a.ignoreCase === b.ignoreCase &&\n        a.multiline === b.multiline &&\n        a.global === b.global;\n  }\n\n  if (typeof a !== 'object' && typeof b !== 'object') {\n    return a === b;\n  }\n\n  if (a === null || b === null || a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (a.prototype !== b.prototype) {\n    return false;\n  }\n\n  // Handle MongooseNumbers\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n\n  if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n  if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n\n  let ka;\n  let kb;\n  let key;\n  let i;\n  try {\n    ka = Object.keys(a);\n    kb = Object.keys(b);\n  } catch (e) {\n    // happens when one is a string literal and the other isn't\n    return false;\n  }\n\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length !== kb.length) {\n    return false;\n  }\n\n  // the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n\n  // ~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  }\n\n  // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n/*!\n * Get the last element of an array\n */\n\nexports.last = function(arr) {\n  if (arr.length > 0) {\n    return arr[arr.length - 1];\n  }\n  return void 0;\n};\n\nexports.clone = clone;\n\n/*!\n * ignore\n */\n\nexports.promiseOrCallback = promiseOrCallback;\n\n/*!\n * ignore\n */\n\nexports.omit = function omit(obj, keys) {\n  if (keys == null) {\n    return Object.assign({}, obj);\n  }\n  if (!Array.isArray(keys)) {\n    keys = [keys];\n  }\n\n  const ret = Object.assign({}, obj);\n  for (const key of keys) {\n    delete ret[key];\n  }\n  return ret;\n};\n\n\n/*!\n * Shallow copies defaults into options.\n *\n * @param {Object} defaults\n * @param {Object} options\n * @return {Object} the merged object\n * @api private\n */\n\nexports.options = function(defaults, options) {\n  const keys = Object.keys(defaults);\n  let i = keys.length;\n  let k;\n\n  options = options || {};\n\n  while (i--) {\n    k = keys[i];\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n\n  return options;\n};\n\n/*!\n * Generates a random string\n *\n * @api private\n */\n\nexports.random = function() {\n  return Math.random().toString().substr(3);\n};\n\n/*!\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\nexports.merge = function merge(to, from, options, path) {\n  options = options || {};\n\n  const keys = Object.keys(from);\n  let i = 0;\n  const len = keys.length;\n  let key;\n\n  path = path || '';\n  const omitNested = options.omitNested || {};\n\n  while (i < len) {\n    key = keys[i++];\n    if (options.omit && options.omit[key]) {\n      continue;\n    }\n    if (omitNested[path]) {\n      continue;\n    }\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    if (to[key] == null) {\n      to[key] = from[key];\n    } else if (exports.isObject(from[key])) {\n      if (!exports.isObject(to[key])) {\n        to[key] = {};\n      }\n      if (from[key] != null) {\n        if (from[key].instanceOfSchema) {\n          if (to[key].instanceOfSchema) {\n            to[key].add(from[key].clone());\n          } else {\n            to[key] = from[key].clone();\n          }\n          continue;\n        } else if (from[key] instanceof ObjectId) {\n          to[key] = new ObjectId(from[key]);\n          continue;\n        }\n      }\n      merge(to[key], from[key], options, path ? path + '.' + key : key);\n    } else if (options.overwrite) {\n      to[key] = from[key];\n    }\n  }\n};\n\n/*!\n * Applies toObject recursively.\n *\n * @param {Document|Array|Object} obj\n * @return {Object}\n * @api private\n */\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  let ret;\n\n  if (obj == null) {\n    return obj;\n  }\n\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n\n  if (Array.isArray(obj)) {\n    ret = [];\n\n    for (const doc of obj) {\n      ret.push(toObject(doc));\n    }\n\n    return ret;\n  }\n\n  if (exports.isPOJO(obj)) {\n    ret = {};\n\n    for (const k in obj) {\n      if (specialProperties.has(k)) {\n        continue;\n      }\n      ret[k] = toObject(obj[k]);\n    }\n\n    return ret;\n  }\n\n  return obj;\n};\n\nexports.isObject = isObject;\n\n/*!\n * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,\n * `arg` must be an object but not an instance of any special class, like String,\n * ObjectId, etc.\n *\n * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\nexports.isPOJO = function isPOJO(arg) {\n  if (arg == null || typeof arg !== 'object') {\n    return false;\n  }\n  const proto = Object.getPrototypeOf(arg);\n  // Prototype may be null if you used `Object.create(null)`\n  // Checking `proto`'s constructor is safe because `getPrototypeOf()`\n  // explicitly crosses the boundary from object data to object metadata\n  return !proto || proto.constructor.name === 'Object';\n};\n\n/*!\n * Determines if `obj` is a built-in object like an array, date, boolean,\n * etc.\n */\n\nexports.isNativeObject = function(arg) {\n  return Array.isArray(arg) ||\n    arg instanceof Date ||\n    arg instanceof Boolean ||\n    arg instanceof Number ||\n    arg instanceof String;\n};\n\n/*!\n * Determines if `val` is an object that has no own keys\n */\n\nexports.isEmptyObject = function(val) {\n  return val != null &&\n    typeof val === 'object' &&\n    Object.keys(val).length === 0;\n};\n\n/*!\n * Search if `obj` or any POJOs nested underneath `obj` has a property named\n * `key`\n */\n\nexports.hasKey = function hasKey(obj, key) {\n  const props = Object.keys(obj);\n  for (const prop of props) {\n    if (prop === key) {\n      return true;\n    }\n    if (exports.isPOJO(obj[prop]) && exports.hasKey(obj[prop], key)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/*!\n * A faster Array.prototype.slice.call(arguments) alternative\n * @api private\n */\n\nexports.args = sliced;\n\n/*!\n * process.nextTick helper.\n *\n * Wraps `callback` in a try/catch + nextTick.\n *\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\n *\n * @param {Function} callback\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n  return function() {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      process.nextTick(function() {\n        throw err;\n      });\n    }\n  };\n};\n\n/*!\n * Returns true if `v` is an object that can be serialized as a primitive in\n * MongoDB\n */\n\nexports.isMongooseType = function(v) {\n  return v instanceof ObjectId || v instanceof Decimal || v instanceof Buffer;\n};\n\nexports.isMongooseObject = isMongooseObject;\n\n/*!\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\n *\n * @param {Object} object\n * @api private\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n  if (!('expires' in object)) {\n    return;\n  }\n\n  let when;\n  if (typeof object.expires !== 'string') {\n    when = object.expires;\n  } else {\n    when = Math.round(ms(object.expires) / 1000);\n  }\n  object.expireAfterSeconds = when;\n  delete object.expires;\n};\n\n/*!\n * populate helper\n */\n\nexports.populate = function populate(path, select, model, match, options, subPopulate, justOne, count) {\n  // might have passed an object specifying all arguments\n  let obj = null;\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      return [path];\n    }\n\n    if (Array.isArray(path)) {\n      const singles = makeSingles(path);\n      return singles.map(o => exports.populate(o)[0]);\n    }\n\n    if (exports.isObject(path)) {\n      obj = Object.assign({}, path);\n    } else {\n      obj = { path: path };\n    }\n  } else if (typeof model === 'object') {\n    obj = {\n      path: path,\n      select: select,\n      match: model,\n      options: match\n    };\n  } else {\n    obj = {\n      path: path,\n      select: select,\n      model: model,\n      match: match,\n      options: options,\n      populate: subPopulate,\n      justOne: justOne,\n      count: count\n    };\n  }\n\n  if (typeof obj.path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n\n  return _populateObj(obj);\n\n  // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n  function makeSingles(arr) {\n    const ret = [];\n    arr.forEach(function(obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const paths = obj.path.split(' ');\n        paths.forEach(function(p) {\n          const copy = Object.assign({}, obj);\n          copy.path = p;\n          ret.push(copy);\n        });\n      } else {\n        ret.push(obj);\n      }\n    });\n\n    return ret;\n  }\n};\n\nfunction _populateObj(obj) {\n  if (Array.isArray(obj.populate)) {\n    const ret = [];\n    obj.populate.forEach(function(obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const copy = Object.assign({}, obj);\n        const paths = copy.path.split(' ');\n        paths.forEach(function(p) {\n          copy.path = p;\n          ret.push(exports.populate(copy)[0]);\n        });\n      } else {\n        ret.push(exports.populate(obj)[0]);\n      }\n    });\n    obj.populate = exports.populate(ret);\n  } else if (obj.populate != null && typeof obj.populate === 'object') {\n    obj.populate = exports.populate(obj.populate);\n  }\n\n  const ret = [];\n  const paths = obj.path.split(' ');\n  if (obj.options != null) {\n    obj.options = exports.clone(obj.options);\n  }\n\n  for (const path of paths) {\n    ret.push(new PopulateOptions(Object.assign({}, obj, { path: path })));\n  }\n\n  return ret;\n}\n\n/*!\n * Return the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Object} obj\n */\n\nexports.getValue = function(path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n\n/*!\n * Sets the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Anything} val\n * @param {Object} obj\n */\n\nexports.setValue = function(path, val, obj, map, _copying) {\n  mpath.set(path, val, obj, '_doc', map, _copying);\n};\n\n/*!\n * Returns an array of values from object `o`.\n *\n * @param {Object} o\n * @return {Array}\n * @private\n */\n\nexports.object = {};\nexports.object.vals = function vals(o) {\n  const keys = Object.keys(o);\n  let i = keys.length;\n  const ret = [];\n\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n\n  return ret;\n};\n\n/*!\n * @see exports.options\n */\n\nexports.object.shallowCopy = exports.options;\n\n/*!\n * Safer helper for hasOwnProperty checks\n *\n * @param {Object} obj\n * @param {String} prop\n */\n\nconst hop = Object.prototype.hasOwnProperty;\nexports.object.hasOwnProperty = function(obj, prop) {\n  return hop.call(obj, prop);\n};\n\n/*!\n * Determine if `val` is null or undefined\n *\n * @return {Boolean}\n */\n\nexports.isNullOrUndefined = function(val) {\n  return val === null || val === undefined;\n};\n\n/*!\n * ignore\n */\n\nexports.array = {};\n\n/*!\n * Flattens an array.\n *\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\n *\n * @param {Array} arr\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.\n * @return {Array}\n * @private\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n\n  arr.forEach(function(item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n\n  return ret;\n};\n\n/*!\n * ignore\n */\n\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexports.hasUserDefinedProperty = function(obj, key) {\n  if (obj == null) {\n    return false;\n  }\n\n  if (Array.isArray(key)) {\n    for (const k of key) {\n      if (exports.hasUserDefinedProperty(obj, k)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  if (_hasOwnProperty.call(obj, key)) {\n    return true;\n  }\n  if (typeof obj === 'object' && key in obj) {\n    const v = obj[key];\n    return v !== Object.prototype[key] && v !== Array.prototype[key];\n  }\n\n  return false;\n};\n\n/*!\n * ignore\n */\n\nconst MAX_ARRAY_INDEX = Math.pow(2, 32) - 1;\n\nexports.isArrayIndex = function(val) {\n  if (typeof val === 'number') {\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n  if (typeof val === 'string') {\n    if (!/^\\d+$/.test(val)) {\n      return false;\n    }\n    val = +val;\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n\n  return false;\n};\n\n/*!\n * Removes duplicate values from an array\n *\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\n *\n * @param {Array} arr\n * @return {Array}\n * @private\n */\n\nexports.array.unique = function(arr) {\n  const primitives = {};\n  const ids = {};\n  const ret = [];\n\n  for (const item of arr) {\n    if (typeof item === 'number' || typeof item === 'string' || item == null) {\n      if (primitives[item]) {\n        continue;\n      }\n      ret.push(item);\n      primitives[item] = true;\n    } else if (item instanceof ObjectId) {\n      if (ids[item.toString()]) {\n        continue;\n      }\n      ret.push(item);\n      ids[item.toString()] = true;\n    } else {\n      ret.push(item);\n    }\n  }\n\n  return ret;\n};\n\n/*!\n * Determines if two buffers are equal.\n *\n * @param {Buffer} a\n * @param {Object} b\n */\n\nexports.buffer = {};\nexports.buffer.areEqual = function(a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n  if (a.length !== b.length) {\n    return false;\n  }\n  for (let i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexports.getFunctionName = getFunctionName;\n/*!\n * Decorate buffers\n */\n\nexports.decorate = function(destination, source) {\n  for (const key in source) {\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    destination[key] = source[key];\n  }\n};\n\n/**\n * merges to with a copy of from\n *\n * @param {Object} to\n * @param {Object} fromObj\n * @api private\n */\n\nexports.mergeClone = function(to, fromObj) {\n  if (isMongooseObject(fromObj)) {\n    fromObj = fromObj.toObject({\n      transform: false,\n      virtuals: false,\n      depopulate: true,\n      getters: false,\n      flattenDecimals: false\n    });\n  }\n  const keys = Object.keys(fromObj);\n  const len = keys.length;\n  let i = 0;\n  let key;\n\n  while (i < len) {\n    key = keys[i++];\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    if (typeof to[key] === 'undefined') {\n      to[key] = exports.clone(fromObj[key], {\n        transform: false,\n        virtuals: false,\n        depopulate: true,\n        getters: false,\n        flattenDecimals: false\n      });\n    } else {\n      let val = fromObj[key];\n      if (val != null && val.valueOf && !(val instanceof Date)) {\n        val = val.valueOf();\n      }\n      if (exports.isObject(val)) {\n        let obj = val;\n        if (isMongooseObject(val) && !val.isMongooseBuffer) {\n          obj = obj.toObject({\n            transform: false,\n            virtuals: false,\n            depopulate: true,\n            getters: false,\n            flattenDecimals: false\n          });\n        }\n        if (val.isMongooseBuffer) {\n          obj = Buffer.from(obj);\n        }\n        exports.mergeClone(to[key], obj);\n      } else {\n        to[key] = exports.clone(val, {\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n\n/**\n * Executes a function on each element of an array (like _.each)\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\nexports.each = function(arr, fn) {\n  for (const item of arr) {\n    fn(item);\n  }\n};\n\n/*!\n * ignore\n */\n\nexports.getOption = function(name) {\n  const sources = Array.prototype.slice.call(arguments, 1);\n\n  for (const source of sources) {\n    if (source[name] != null) {\n      return source[name];\n    }\n  }\n\n  return null;\n};\n\n/*!\n * ignore\n */\n\nexports.noop = function() {};\n"]},"metadata":{},"sourceType":"script"}