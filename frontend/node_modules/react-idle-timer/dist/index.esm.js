var ct=Object.create,Ie=Object.defineProperty;var mt=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var pt=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var ht=t=>Ie(t,"__esModule",{value:!0});var vt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Tt=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of dt(e))!ft.call(t,r)&&r!=="default"&&Ie(t,r,{get:()=>e[r],enumerable:!(n=mt(e,r))||n.enumerable});return t},It=t=>Tt(ht(Ie(t!=null?ct(pt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Ue=vt((ie,Fe)=>{(function(t,e){typeof ie=="object"&&typeof Fe!="undefined"?e(ie):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.fastUniqueNumbers={}))})(ie,function(t){"use strict";var e=function(p){return function(h){var o=p(h);return h.add(o),o}},n=function(p){return function(h,o){return p.set(h,o),o}},r=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,a=536870912,u=a*2,b=function(p,h){return function(o){var x=h.get(o),M=x===void 0?o.size:x<u?x+1:0;if(!o.has(M))return p(o,M);if(o.size<a){for(;o.has(M);)M=Math.floor(Math.random()*u);return p(o,M)}if(o.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(M);)M=Math.floor(Math.random()*r);return p(o,M)}},W=new WeakMap,ee=n(W),m=b(ee,W),c=e(m);t.addUniqueNumber=c,t.generateUniqueNumber=m,Object.defineProperty(t,"__esModule",{value:!0})})});import Et,{forwardRef as bt}from"react";function gt(t){return bt(function(n,r){let a={...n};!a.onPrompt&&t.prototype.onPrompt&&(a.onPrompt=()=>{t.prototype.onPrompt()}),!a.onIdle&&t.prototype.onIdle&&(a.onIdle=()=>{t.prototype.onIdle()}),!a.onActive&&t.prototype.onActive&&(a.onActive=b=>{t.prototype.onActive(b)}),!a.onAction&&t.prototype.onAction&&(a.onAction=b=>{t.prototype.onAction(b)});let u=$(a);return typeof r=="function"?r(u):r&&(r.current=u),Et.createElement(t,{...n,...u})})}import{useEffect as U,useRef as f,useCallback as I}from"react";var K=It(Ue());var We=t=>t.method!==void 0&&t.method==="call";var Be=t=>t.error===null&&typeof t.id=="number";var Ve=t=>{let e=new Map([[0,()=>{}]]),n=new Map([[0,()=>{}]]),r=new Map,a=new Worker(t);return a.addEventListener("message",({data:m})=>{if(We(m)){let{params:{timerId:c,timerType:d}}=m;if(d==="interval"){let p=e.get(c);if(typeof p=="number"){let h=r.get(p);if(h===void 0||h.timerId!==c||h.timerType!==d)throw new Error("The timer is in an undefined state.")}else if(typeof p!="undefined")p();else throw new Error("The timer is in an undefined state.")}else if(d==="timeout"){let p=n.get(c);if(typeof p=="number"){let h=r.get(p);if(h===void 0||h.timerId!==c||h.timerType!==d)throw new Error("The timer is in an undefined state.")}else if(typeof p!="undefined")p(),n.delete(c);else throw new Error("The timer is in an undefined state.")}}else if(Be(m)){let{id:c}=m,d=r.get(c);if(d===void 0)throw new Error("The timer is in an undefined state.");let{timerId:p,timerType:h}=d;r.delete(c),h==="interval"?e.delete(p):n.delete(p)}else{let{error:{message:c}}=m;throw new Error(c)}}),{clearInterval:m=>{let c=(0,K.generateUniqueNumber)(r);r.set(c,{timerId:m,timerType:"interval"}),e.set(m,c),a.postMessage({id:c,method:"clear",params:{timerId:m,timerType:"interval"}})},clearTimeout:m=>{let c=(0,K.generateUniqueNumber)(r);r.set(c,{timerId:m,timerType:"timeout"}),n.set(m,c),a.postMessage({id:c,method:"clear",params:{timerId:m,timerType:"timeout"}})},setInterval:(m,c)=>{let d=(0,K.generateUniqueNumber)(e);return e.set(d,()=>{m(),typeof e.get(d)=="function"&&a.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:d,timerType:"interval"}})}),a.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:d,timerType:"interval"}}),d},setTimeout:(m,c)=>{let d=(0,K.generateUniqueNumber)(n);return n.set(d,m),a.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:d,timerType:"timeout"}}),d}}};var Q=null,He=(t,e)=>()=>{if(Q!==null)return Q;let n=new Blob([e],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(n);return Q=t(r),Q.setTimeout(()=>URL.revokeObjectURL(r),0),Q};var Ge=`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`;var se=He(Ve,Ge),qe=t=>se().clearInterval(t),je=t=>se().clearTimeout(t),Ye=(t,e)=>se().setInterval(t,e),Je=(t,e)=>se().setTimeout(t,e);var w=(typeof window=="undefined"?"undefined":typeof window)=="object";var T={setTimeout:w?setTimeout.bind(window):setTimeout,clearTimeout:w?clearTimeout.bind(window):clearTimeout,setInterval:w?setInterval.bind(window):setInterval,clearInterval:w?clearInterval.bind(window):clearInterval},Z={setTimeout:Je,clearTimeout:je,setInterval:Ye,clearInterval:qe};function wt(){T.setTimeout=setTimeout,T.clearTimeout=clearTimeout,T.setInterval=setInterval,T.clearInterval=clearInterval,Z.setTimeout=setTimeout,Z.clearTimeout=clearTimeout,Z.setInterval=setInterval,Z.clearInterval=clearInterval}function ze(t){T.setTimeout=t.setTimeout,T.clearTimeout=t.clearTimeout,T.setInterval=t.setInterval,T.clearInterval=t.clearInterval}var Y={},Xe=class{constructor(e){this.closed=!1;this.mc=new MessageChannel;this.name=e,Y[e]=Y[e]||[],Y[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let n=JSON.parse(e.newValue);this.mc.port2.postMessage(n)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let n=JSON.stringify(e),r=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(r,n),T.setTimeout(()=>{window.localStorage.removeItem(r)},500),Y[this.name].forEach(a=>{a!==this&&a.mc.port2.postMessage(JSON.parse(n))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=Y[this.name].indexOf(this);Y[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,n){return this.mc.port1.addEventListener(e,n)}removeEventListener(e,n){return this.mc.port1.removeEventListener(e,n)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},$e=typeof window=="undefined"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:Xe;function Ke(t=0){return new Promise(e=>T.setTimeout(e,t))}function ae(){return Math.random().toString(36).substring(2)}var l;(function(o){o[o.APPLY=0]="APPLY",o[o.TELL=1]="TELL",o[o.CLOSE=2]="CLOSE",o[o.REGISTER=3]="REGISTER",o[o.DEREGISTER=4]="DEREGISTER",o[o.IDLE=5]="IDLE",o[o.ACTIVE=6]="ACTIVE",o[o.PROMPT=7]="PROMPT",o[o.START=8]="START",o[o.RESET=9]="RESET",o[o.ACTIVATE=10]="ACTIVATE",o[o.PAUSE=11]="PAUSE",o[o.RESUME=12]="RESUME",o[o.MESSAGE=13]="MESSAGE"})(l||(l={}));var Ee=class{constructor(e,n){this.token=ae();this.isLeader=!1;this.isDead=!1;this.isApplying=!1;this.reApply=!1;this.intervals=[];this.listeners=[];this.channel=e,this.options=n,this.apply=this.apply.bind(this),this.awaitLeadership=this.awaitLeadership.bind(this),this.sendAction=this.sendAction.bind(this)}async apply(){if(this.isLeader||this.isDead)return!1;if(this.isApplying)return this.reApply=!0,!1;this.isApplying=!0;let e=!1,n=r=>{let{token:a,action:u}=r.data;a!==this.token&&(u===l.APPLY&&a>this.token&&(e=!0),u===l.TELL&&(e=!0))};this.channel.addEventListener("message",n);try{return this.sendAction(l.APPLY),await Ke(this.options.responseTime),this.channel.removeEventListener("message",n),this.isApplying=!1,e?this.reApply?this.apply():!1:(this.assumeLead(),!0)}catch{return!1}}awaitLeadership(){if(this.isLeader)return Promise.resolve();let e=!1,n=null;return new Promise(r=>{let a=()=>{if(e)return;e=!0,T.clearInterval(n);let b=this.intervals.indexOf(n);this.intervals.splice(b,1),this.channel.removeEventListener("message",u),r()};n=T.setInterval(()=>{this.apply().then(()=>{this.isLeader&&a()})},this.options.fallbackInterval),this.intervals.push(n);let u=b=>{let{action:W}=b.data;W===l.CLOSE&&this.apply().then(()=>{this.isLeader&&a()})};this.channel.addEventListener("message",u)})}sendAction(e){this.channel.postMessage({action:e,token:this.token})}assumeLead(){this.isLeader=!0;let e=n=>{let{action:r}=n.data;r===l.APPLY&&this.sendAction(l.TELL)};return this.channel.addEventListener("message",e),this.listeners.push(e),this.sendAction(l.TELL)}waitForLeadership(){return this.deferred?this.deferred:(this.deferred=this.awaitLeadership(),this.deferred)}close(){this.isDead||(this.isDead=!0,this.isLeader=!1,this.sendAction(l.CLOSE),this.listeners.forEach(e=>this.channel.removeEventListener("message",e)),this.intervals.forEach(e=>T.clearInterval(e)))}};var k;(function(r){r[r.PROMPTED=0]="PROMPTED",r[r.ACTIVE=1]="ACTIVE",r[r.IDLE=2]="IDLE"})(k||(k={}));var be=class{constructor(e){this.token=ae();this.registry=new Map;this.allIdle=!1;let{channelName:n}=e;if(this.options=e,this.channel=new $e(n),this.registry.set(this.token,1),e.leaderElection){let r={fallbackInterval:2e3,responseTime:100};this.elector=new Ee(this.channel,r),this.elector.waitForLeadership()}this.channel.addEventListener("message",r=>{let{action:a,token:u,data:b}=r.data;switch(a){case l.REGISTER:this.registry.set(u,2);break;case l.DEREGISTER:this.registry.delete(u);break;case l.IDLE:this.idle(u);break;case l.ACTIVE:this.active(u);break;case l.PROMPT:this.prompt(u);break;case l.START:this.start(u);break;case l.RESET:this.reset(u);break;case l.ACTIVATE:this.activate(u);break;case l.PAUSE:this.pause(u);break;case l.RESUME:this.resume(u);break;case l.MESSAGE:this.options.onMessage(b);break}}),this.send(l.REGISTER)}get isLeader(){if(!this.elector)throw new Error('\u274C Leader election is not enabled. To Enable it set the "leaderElection" property to true.');return this.elector.isLeader}prompt(e=this.token){this.registry.set(e,0);let n=[...this.registry.values()].every(r=>r===0);e===this.token&&this.send(l.PROMPT),n&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let n=[...this.registry.values()].every(r=>r===2);e===this.token&&this.send(l.IDLE),!this.allIdle&&n&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.allIdle=!1,this.registry.set(e,1);let n=[...this.registry.values()].some(r=>r===1);e===this.token&&this.send(l.ACTIVE),n&&this.options.onActive()}start(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(l.START):this.options.start(!0)}reset(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(l.RESET):this.options.reset(!0)}activate(e=this.token){this.allIdle=!1,this.registry.set(e,1),e===this.token?this.send(l.ACTIVATE):this.options.activate(!0)}pause(e=this.token){e===this.token?this.send(l.PAUSE):this.options.pause(!0)}resume(e=this.token){e===this.token?this.send(l.RESUME):this.options.resume(!0)}message(e){try{this.channel.postMessage({action:l.MESSAGE,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.options.leaderElection&&this.elector.close(),this.send(l.DEREGISTER),this.channel.close()}};var Qe=w?document:null,ge=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange"];import{useRef as yt,useEffect as Lt}from"react";function F(t){let e=yt(t);return Lt(()=>{e.current=t},[t]),e}function Ze(t,e){let n;function r(...a){n&&clearTimeout(n),n=setTimeout(()=>{t(...a),n=null},e)}return r.cancel=function(){clearTimeout(n)},r}function le(t,e){let n=0;return function(...r){let a=new Date().getTime();if(!(a-n<e))return n=a,t(...r)}}var E=()=>w?performance.now():Date.now();function $({timeout:t=1e3*60*20,promptTimeout:e=0,element:n=Qe,events:r=ge,timers:a=void 0,immediateEvents:u=[],onPrompt:b=()=>{},onIdle:W=()=>{},onActive:ee=()=>{},onAction:m=()=>{},onMessage:c=()=>{},debounce:d=0,throttle:p=0,eventsThrottle:h=200,startOnMount:o=!0,startManually:x=!1,stopOnIdle:M=!1,crossTab:G=!1,name:we="idle-timer",syncTimers:J=0,leaderElection:ye=!1}={}){let q=f(E()),Le=f(Date.now()),te=f(E()),D=f(null),N=f(null),z=f(0),v=f(!0),A=f(!1),B=f(!0),X=f(!1),g=f(!1),y=f(0),R=f(0),O=f(null),s=f(null),C=F(t),re=F(e),et=F(M),ke=f(u),ce=f(n),me=f([...new Set([...r,...u]).values()]),xe=F(W),de=F(ee),Me=F(b),ne=F(c),L=f();U(()=>{L.current&&L.current.cancel&&L.current.cancel(),d>0?L.current=Ze(m,d):p>0?L.current=le(m,p):L.current=m},[m,p,d]);let Pe=f();U(()=>{G&&J&&(Pe.current=le(()=>{s.current.active()},J))},[G,J]);let P=()=>{O.current!==null&&(T.clearTimeout(O.current),O.current=null)},V=(i,S=!0)=>{P(),O.current=T.setTimeout(fe,i||C.current),S&&(N.current=E())},Se=i=>{y.current=0,R.current=E(),g.current=!0,V(re.current,!1),Me.current(i)},Ae=()=>{P(),v.current=!0,D.current=E(),et.current?H():g.current&&(R.current=0,g.current=!1),xe.current()},pe=i=>{P(),g.current=!1,R.current=0,v.current=!1,z.current+=E()-D.current,_(),V(),de.current(i)},fe=i=>{if(!v.current){if(L.current.cancel&&L.current.cancel(),re.current>0&&!g.current){s.current?s.current.prompt():Se(i);return}s.current?s.current.idle():Ae();return}s.current?s.current.active():pe(i)},Re=i=>{if(L.current(i),g.current)return;if(P(),!v.current&&ke.current.includes(i.type)){fe(i);return}let S=E()-N.current;if(v.current&&!M||!v.current&&S>C.current){fe(i);return}A.current=!1,y.current=0,R.current=0,V(),G&&J&&Pe.current()},oe=f();U(()=>{let i=X.current;i&&H(),h>0?oe.current=le(Re,h):oe.current=Re,i&&_()},[h,G,J]);let _=()=>{!w||X.current||(me.current.forEach(i=>{ce.current.addEventListener(i,oe.current,{capture:!0,passive:!0})}),X.current=!0)},H=(i=!1)=>{!w||(X.current||i)&&(me.current.forEach(S=>{ce.current.removeEventListener(S,oe.current,{capture:!0})}),X.current=!1)},j=I(i=>{P(),_(),v.current=!1,g.current=!1,A.current=!1,y.current=0,R.current=0,s.current&&!i&&s.current.start(),V()},[O,v,C,s]),he=I(i=>{P(),_(),v.current=!1,g.current=!1,A.current=!1,y.current=0,R.current=0,q.current=E(),te.current=E(),s.current&&!i&&s.current.reset(),x||V()},[O,v,C,x,s]),Oe=I(i=>{P(),_(),(v.current||g.current)&&pe(),v.current=!1,g.current=!1,A.current=!1,y.current=0,R.current=0,te.current=E(),s.current&&!i&&s.current.activate(),V()},[O,v,C,s]),ve=I((i=!1)=>A.current?!1:(y.current=Ce(),A.current=!0,H(),P(),s.current&&!i&&s.current.pause(),!0),[O,s]),Te=I((i=!1)=>A.current?(A.current=!1,g.current||_(),v.current||V(y.current),R.current&&(R.current=E()),s.current&&!i&&s.current.resume(),!0):!1,[O,C,y,s]),tt=I((i,S)=>{s.current?(S&&ne.current(i),s.current.message(i)):S&&ne.current(i)},[c]),rt=I(()=>v.current,[v]),nt=I(()=>g.current,[g]),ot=I(()=>{if(!s.current)throw new Error('\u274C Cross Tab feature is not enabled. To enable it set the "crossTab" property to true.');return s.current.isLeader},[s]),it=I(()=>{if(!s.current)throw new Error('\u274C Cross Tab feature is not enabled. To enable it set the "crossTab" property to true.');return s.current.token},[s]),Ce=I(()=>{if(A.current)return y.current;let i=y.current?y.current:re.current+C.current,S=N.current?E()-N.current:0,_e=Math.ceil(i-S);return _e<0?0:Math.abs(_e)},[C,re,g,y,N]),st=I(()=>Math.round(E()-te.current),[te]),De=I(()=>Math.round(E()-q.current),[q]),at=I(()=>D.current?new Date(Le.current-q.current+D.current):null,[D]),lt=I(()=>N.current?new Date(Le.current-q.current+N.current):null,[N]),Ne=I(()=>v.current?Math.round(E()-D.current+z.current):Math.round(z.current),[D,z]),ut=I(()=>{let i=Math.round(De()-Ne());return i>=0?i:0},[q,D,z]);return U(()=>{if(d>0&&p>0)throw new Error("\u274C onAction can either be throttled or debounced, not both.");a&&ze(a);let i=()=>{s.current&&s.current.close(),L.current.cancel&&L.current.cancel(),P(),H(!0)};return w&&window.addEventListener("beforeunload",i),()=>{w&&window.removeEventListener("beforeunload",i),s.current&&s.current.close(),L.current.cancel&&L.current.cancel(),P(),H(!0)}},[]),U(()=>{s.current&&s.current.close(),G?s.current=new be({channelName:we,leaderElection:ye,onPrompt:()=>{Se()},onIdle:()=>{Ae()},onActive:()=>{pe()},onMessage:ne.current,start:j,reset:he,activate:Oe,pause:ve,resume:Te}):s.current=null},[G,we,ye,Me,xe,de,ne,j,he,ve,Te]),U(()=>{P(),H(!0),B.current||(A.current=!0,v.current=!0,y.current=0),!x&&(o?j():_())},[x,o,B]),U(()=>{if(!B.current){let i=[...new Set([...r,...u]).values()];if(H(),me.current=i,ce.current=n,ke.current=u,x)return;o?j():_()}},[n,JSON.stringify(r),JSON.stringify(u),B,x,o]),U(()=>{if(B.current)B.current=!1;else{if(C.current=t,x)return;v.current&&(de.current(),s.current&&s.current.active()),j()}},[t,s,x,B,v]),{message:tt,start:j,reset:he,activate:Oe,pause:ve,resume:Te,isIdle:rt,isPrompted:nt,isLeader:ot,getTabId:it,getRemainingTime:Ce,getElapsedTime:st,getTotalElapsedTime:De,getLastIdleTime:at,getLastActiveTime:lt,getTotalIdleTime:Ne,getTotalActiveTime:ut}}import kt,{createContext as xt,useContext as Mt}from"react";var ue=xt(null);function Pt(t){let e=$(t);return kt.createElement(ue.Provider,{value:e},t.children)}var St=ue.Consumer;function At(){return Mt(ue)}export{ge as DEFAULT_EVENTS,St as IdleTimerConsumer,ue as IdleTimerContext,Pt as IdleTimerProvider,wt as createMocks,$ as useIdleTimer,At as useIdleTimerContext,gt as withIdleTimer,Z as workerTimers};
